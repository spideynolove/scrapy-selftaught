define("metaserver/static/js/starred/browse_exports",["require","exports","metaserver/static/js/home/resource_id_types","metaserver/static/js/starred/actions","metaserver/static/js/starred/browse_update","metaserver/static/js/starred/constants","metaserver/static/js/starred/id_type_pair","metaserver/static/js/starred/star","metaserver/static/js/starred/store","metaserver/static/js/starred/redux/store","metaserver/static/js/starred/redux/slice","metaserver/static/js/starred/redux/selectors"],(function(e,t,s,a,r,i,n,o,l,c,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getStarredBoolObject=t.getIsStarred=t.getStarredFileIds=t.getStarredState=t.updateStarredStatus=t.fetchMissingStarredStatuses=t.getStoreForStarred=t.StarredStore=t.Star=t.itemNameFromStarrableItem=t.idTypePairFromStarrableItem=t.StarredSource=t.checkForMissingStarredData=t.StarredActions=t.HOME_RESOURCE_ID_TYPE=void 0,Object.defineProperty(t,"HOME_RESOURCE_ID_TYPE",{enumerable:!0,get:function(){return s.HOME_RESOURCE_ID_TYPE}}),Object.defineProperty(t,"StarredActions",{enumerable:!0,get:function(){return a.StarredActions}}),Object.defineProperty(t,"checkForMissingStarredData",{enumerable:!0,get:function(){return r.checkForMissingStarredData}}),Object.defineProperty(t,"StarredSource",{enumerable:!0,get:function(){return i.StarredSource}}),Object.defineProperty(t,"idTypePairFromStarrableItem",{enumerable:!0,get:function(){return n.idTypePairFromStarrableItem}}),Object.defineProperty(t,"itemNameFromStarrableItem",{enumerable:!0,get:function(){return n.itemNameFromStarrableItem}}),Object.defineProperty(t,"Star",{enumerable:!0,get:function(){return o.Star}}),Object.defineProperty(t,"StarredStore",{enumerable:!0,get:function(){return l.StarredStore}}),Object.defineProperty(t,"getStoreForStarred",{enumerable:!0,get:function(){return c.getStoreForStarred}}),Object.defineProperty(t,"fetchMissingStarredStatuses",{enumerable:!0,get:function(){return d.fetchMissingStarredStatuses}}),Object.defineProperty(t,"updateStarredStatus",{enumerable:!0,get:function(){return d.updateStarredStatus}}),Object.defineProperty(t,"getStarredState",{enumerable:!0,get:function(){return u.getStarredState}}),Object.defineProperty(t,"getStarredFileIds",{enumerable:!0,get:function(){return u.getStarredFileIds}}),Object.defineProperty(t,"getIsStarred",{enumerable:!0,get:function(){return u.getIsStarred}}),Object.defineProperty(t,"getStarredBoolObject",{enumerable:!0,get:function(){return u.getStarredBoolObject}})})),define("metaserver/static/js/modules/clean/mobile_tracker",["require","exports","tslib","metaserver/static/js/modules/core/browser","metaserver/static/js/modules/core/uri"],(function(e,t,s,a,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getMobileTrackerCampaignParams=void 0,a=s.__importStar(a);const i=["src","campaign","adgroup","creative"];t.getMobileTrackerCampaignParams=function(){const e=r.URI.parse(a.get_href()).getQuery(),t={};for(const s in e)i.includes(s)&&(t[s]=e[s]);return t}})),define("metaserver/static/js/browse/file_actions/action_handlers",["require","exports","tslib","metaserver/static/js/modules/clean/sharing/views/copy_link_mini_modal/copy_link_mini_modal","spectrum-sharing/utils/sharing_constants","metaserver/static/js/browse/file_actions/actions/download","metaserver/static/js/modules/clean/browse_interface","metaserver/static/js/modules/clean/filepath/filepath","metaserver/static/js/action_bar/file_actions/portable/go_to_folder","metaserver/static/js/modules/clean/react/async_file_modal_controller","metaserver/static/js/browse/action_logger","metaserver/static/js/browse/actions","metaserver/static/js/browse/actions_navigate","metaserver/static/js/browse/constants","metaserver/static/js/browse/data/folder_overview_selectors","metaserver/static/js/browse/data/store","metaserver/static/js/browse/data/types","metaserver/static/js/browse/file_actions/file_action_helpers","metaserver/static/js/browse/models","metaserver/static/js/file_lock/api","metaserver/static/js/file_transfers/async/browse_entry_point_onboarding_modal_async","metaserver/static/js/files_view/data/action_creators","metaserver/static/js/files_view/data/store","metaserver/static/js/files_view/types","metaserver/static/js/folder_overview/async_components","metaserver/static/js/folder_overview/data/action_creators","metaserver/static/js/folder_overview/data/store","metaserver/static/js/folder_overview/utils","metaserver/static/js/modules/clean/react/snackbar","metaserver/static/js/starred/browse_exports","metaserver/static/js/search/single_page/data/action_creators/file_actions","metaserver/static/js/search/single_page/data/action_creators/index","metaserver/static/js/search/single_page/data/store","metaserver/static/js/search/single_page/data/types","metaserver/static/js/modules/clean/sharing/browse_exports","metaserver/static/js/modules/clean/unity/features","metaserver/static/js/modules/clean/viewer","metaserver/static/js/modules/clean/web_user_action_events","metaserver/static/js/modules/constants/python","metaserver/static/js/modules/core/browser","metaserver/static/js/modules/core/i18n","metaserver/static/js/modules/core/notify","metaserver/static/js/modules/clean/user_survey/user_survey","metaserver/static/js/browse/data/selectors","metaserver/static/js/file_store/utils","metaserver/static/js/file_transfers/lib/urls","metaserver/static/js/modules/clean/sync_everything/constants","metaserver/static/js/modules/constants/web_experience_constants","metaserver/static/js/starred/redux/slice"],(function(e,t,s,a,r,i,n,o,l,c,d,u,p,m,h,f,g,_,b,y,v,S,E,w,M,k,A,N,I,C,R,T,F,L,x,P,O,j,D,U,B,q,W,V,K,H,G,Q,z){"use strict";function X(e,t){const s=e.files.first();if(Q.STARRED_STORE_REDUX){C.getStoreForStarred().dispatch(z.updateStarredStatus({id:s.file_id,newStatus:t,itemName:C.itemNameFromStarrableItem(s),showSnackbar:!0}))}else C.StarredActions.updateWithSnackbar(e.user.role,s.file_id,C.HOME_RESOURCE_ID_TYPE.ENCODED_FILE_OBJ_ID,t,C.itemNameFromStarrableItem(s))}function Y(e,t,s,a=!0){var r,i;_.logUserEventOnFile({args:e,action_type:j.WebUserActionLogEvent.OPEN_DESKTOP});const n=e.files.first(),o=n?n.ns_id:null===(r=e.context)||void 0===r?void 0:r.currentNSID,l=n?n.ns_path:null===(i=e.context)||void 0===i?void 0:i.currentNSPath;P.UnityFeatures.open_file(o||null,l||"/",e.user.id,t,s,a)}Object.defineProperty(t,"__esModule",{value:!0}),t.handleSendForSignature=t.handleShowInFolder=t.handleShareCopyLink=t.handleOpenInDesktop=t.handleOpenInDesktopWithoutStandardHandlers=t.handlePreview=t.handleOpenInNewTab=t.handleReplay=t.handleAddToTransfer=t.handleReAdd=t.handleRewind=t.handleExtensionClick=t.handleExtensionDropdownOpen=t.handleUnstar=t.handleStar=t.handlePermanentDelete=t.handleRestore=t.handleDelete=t.handleUnpin=t.handleBrowsePinTo=t.handleBrowsePin=t.handleManageAsAdmin=t.handleCalculateFolderSize=t.handleEvents=t.handleVersions=t.handleFileRequestUnlock=t.handleFileUnlock=t.handleFileLock=t.handleArchive=t.handleRenameTeamFolder=t.handleComment=t.handleDownload=t.handleRename=t.handleRequestFiles=void 0,o=s.__importStar(o),c=s.__importStar(c),d=s.__importStar(d),h=s.__importStar(h),y=s.__importStar(y),S=s.__importStar(S),k=s.__importStar(k),R=s.__importStar(R),T=s.__importStar(T),U=s.__importStar(U),z=s.__importStar(z),t.handleRequestFiles=function(e){_.logUserEventOnFile({args:e,action_type:j.WebUserActionLogEvent.REQUEST_FILES_CLICK});const{ns_id:t,ns_path:s}=e.files.first();U.redirect(`/requests?ns_id=${t}&path=${s}&referrer=web_browse_file_action`)},t.handleRename=function(e){_.logUserEventOnFile({args:e,action_type:j.WebUserActionLogEvent.RENAME}),E.getStoreForFilesView().dispatch(S.setFileRename({file:e.files.first(),renameState:w.RenameState.PENDING_INPUT}))},t.handleDownload=function(e,t){_.logUserEventOnFile({args:e,action_type:j.WebUserActionLogEvent.DOWNLOAD});const{user:s,files:a}=e;i.downloadFiles({files:a,context:t,user:s,source:e.isSearchMode?"search":"browse",root_ns_id:G.isBackupBrowse()&&t.rootNSID?t.rootNSID:void 0}),W.UserSurvey.trackEvent("download_item","browse")},t.handleComment=function(e){_.logUserEventOnFile({args:e,action_type:j.WebUserActionLogEvent.ADD_COMMENT});const t=e.files.first();t instanceof b.FileSharedWithMe?U.redirect(t.href):e.isSearchMode?F.getStoreForSearch().dispatch(T.setPreviewFile({previewFileId:t.file_id})):p.browseNavigateActions.navigateToFileOrFolder({file:t,shouldFocusComment:!0})},t.handleRenameTeamFolder=function(e){_.logUserEventOnFile({args:e,action_type:j.WebUserActionLogEvent.RENAME_TEAM_FOLDER}),c.showContentManagerBridge(e.files.toArray(),"rename",O.Viewer.get_viewer().team_is_limited)},t.handleArchive=function(e){_.logUserEventOnFile({args:e,action_type:j.WebUserActionLogEvent.ARCHIVE}),c.showContentManagerBridge(e.files.toArray(),"archive",O.Viewer.get_viewer().team_is_limited)},t.handleFileLock=function(e){_.logUserEventOnFile({args:e,action_type:j.WebUserActionLogEvent.LOCK_FILE}),y.showFileLockConfirmModal(e.user.id,e.files.first())},t.handleFileUnlock=function(e){_.logUserEventOnFile({args:e,action_type:j.WebUserActionLogEvent.UNLOCK_FILE}),y.asyncUnlockFile(e.user.id,[e.files.first()])},t.handleFileRequestUnlock=function(e){_.logUserEventOnFile({args:e,action_type:j.WebUserActionLogEvent.REQUEST_UNLOCK_FILE}),y.showRequestUnlockConfirmModal(e.user.id,e.files.first())},t.handleVersions=function(e){var t,s;_.logUserEventOnFile({args:e,action_type:j.WebUserActionLogEvent.VERSIONS});const a=G.isBackupBrowse()&&(null===(t=e.context)||void 0===t?void 0:t.rootNSID)?{inside_backup:"true",ns_id:`${null===(s=e.context)||void 0===s?void 0:s.rootNSID}`,return_url:U.get_href()}:{},r=n.getFileHistoryUrl({fqPath:e.files.first().fq_path,userId:e.user.id},a);U.redirect(r)},t.handleEvents=function(e){_.logUserEventOnFile({args:e,action_type:j.WebUserActionLogEvent.EVENTS}),U.redirect(`/events?ns=${e.files.first().target_ns}`)},t.handleCalculateFolderSize=function(e){_.logUserEventOnFile({args:e,action_type:j.WebUserActionLogEvent.CALCULATE_SIZE});const{files:t}=e;u.browseActions.fetchMultipleFolderSizes({files:t})},t.handleManageAsAdmin=function(t){new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/sharing/content_manager"],t,s)}).then(s.__importStar).then(({goToContentManagerForPath:e})=>{const s=t.files.first();e({containingFolder:s.is_dir?s.fq_path:o.parent_dir(s.fq_path)})})},t.handleBrowsePin=function(e,{snackbarWithShowButton:t}){_.logUserEventOnFile({args:e,action_type:j.WebUserActionLogEvent.FOLDER_OVERVIEW_PIN});const s=A.getStoreForFolderOverview(),a=V.path(s.getState());s.dispatch(k.addContentReferences({folderFileId:h.folderOverviewFolderFileId(s.getState()),fileIds:e.files.toArray().map(N.fileToContentReferenceId),componentNamespace:m.BrowseFolderOverviewComponentNamespace,snackbarConfig:t?{onShow:()=>{u.browseActions.setUrl({path:a,expandedBlade:"pinned_items",forceExpandRightRail:!0})},folderName:o.filename(a,O.Viewer.get_root_name(e.user))}:void 0}))},t.handleBrowsePinTo=function(e,t,{snackbarWithShowButton:s}){const{files:a,user:r}=e;M.asyncShowPinToModal({user:r,path:t.currentFQPath,files:a.toArray(),onFolderSelected:i=>{_.logUserEventOnFile({args:e,action_type:j.WebUserActionLogEvent.FOLDER_OVERVIEW_PIN}),A.getStoreForFolderOverview().dispatch(k.addContentReferencesForPath({files:a.toArray(),path:i,currentPath:t.currentFQPath,snackbarConfig:s?{onShow:()=>{u.browseActions.setUrl({path:i,expandedBlade:"pinned_items",forceExpandRightRail:!0})},folderName:o.filename(i,O.Viewer.get_root_name(r))}:void 0}))},isCurrentPathReadOnly:!t.isCurrentPathWriteable()})},t.handleUnpin=function(e,t){_.logUserEventOnFile({args:e,action_type:j.WebUserActionLogEvent.FOLDER_OVERVIEW_UNPIN});const s=A.getStoreForFolderOverview(),a=V.path(s.getState());s.dispatch(k.removeContentReferences({folderFileId:h.folderOverviewFolderFileId(s.getState()),fileIds:e.files.toArray().map(N.fileToContentReferenceId),componentNamespace:m.BrowseFolderOverviewComponentNamespace,snackbarConfig:t?{onShow:()=>{u.browseActions.setUrl({path:a,expandedBlade:"pinned_items",forceExpandRightRail:!0})},folderName:o.filename(a,O.Viewer.get_root_name(e.user))}:void 0}))},t.handleDelete=function(e,t){_.logUserEventOnFile({args:e,action_type:j.WebUserActionLogEvent.DELETE}),W.UserSurvey.trackEvent("delete_item","browse");const s=e.files.toArray(),a=s.some(b.File.isTeamSharedFolder),r=s.some(e=>e.read_only),i=s.every(e=>e.isDeleted);if(!t.isCurrentPathWriteable()||a||r)a?q.Notify.error(B.intl.formatMessage({id:"AjarNz",defaultMessage:"Team folders can’t be deleted."})):q.Notify.warning(B.intl.formatMessage({id:"q5LxGC",defaultMessage:"You don’t have permission to delete files in this folder."}));else if(e.isSearchMode){const a=F.getStoreForSearch();i?a.dispatch(T.purgeFiles({files:s,user:e.user,context:t})):a.dispatch(R.deleteFiles({files:s}))}else i?u.browseActions.doPermanentDeleteWithModal(s):u.browseActions.doDeleteFilesWithModal({files:s})},t.handleRestore=function(e,t){_.logUserEventOnFile({args:e,action_type:j.WebUserActionLogEvent.RESTORE});const s=e.files.toArray();if(e.isSearchMode){F.getStoreForSearch().dispatch(T.restoreFiles({files:s,user:e.user,context:t}))}else u.browseActions.doRestoreFilesWithUnifiedTrashModal({files:s})},t.handlePermanentDelete=function(e,t){_.logUserEventOnFile({args:e,action_type:j.WebUserActionLogEvent.PERMANENT_DELETE});const s=e.files.toArray();if(e.isSearchMode){F.getStoreForSearch().dispatch(T.purgeFiles({files:s,user:e.user,context:t}))}else u.browseActions.doPermanentDeleteWithModal(s)},t.handleStar=function(e){_.logUserEventOnFile({args:e,action_type:j.WebUserActionLogEvent.STAR}),X(e,!0)},t.handleUnstar=function(e){_.logUserEventOnFile({args:e,action_type:j.WebUserActionLogEvent.REMOVE_STAR}),X(e,!1)},t.handleExtensionDropdownOpen=function(e,t){_.logUserEventOnFile({args:e,action_type:j.WebUserActionLogEvent.OPEN_EXTENSIONS,action_surface:t})},t.handleExtensionClick=function(e,t,s){_.logUserEventOnFile({args:e,action_type:j.WebUserActionLogEvent.EXTENSIONS_SELECTED,action_surface:t,extra:{extensions_option:s||"unknown"}})},t.handleRewind=function(e){_.logUserEventOnFile({args:e,action_type:j.WebUserActionLogEvent.REWIND_CLICK});const t=n.browse_uri_for_fq_path(e.user,e.files.first().fq_path);t.setQuery({rewind:"true"}),U.replace_location(t.toString())},t.handleReAdd=function(e,t){const s=e.files.first().target_ns;s?(_.logUserEventOnFile({args:e,action_type:j.WebUserActionLogEvent.RE_ADD_SHARED_FOLDER_CLICK}),x.asyncMountSharedFolder(s,e.user.role,r.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ACTIONS,!1,null,!0)):_.logUserEventOnFile({args:e,action_type:j.WebUserActionLogEvent.RE_ADD_SHARED_FOLDER_CLICK,extra:{error:"No nsId found, no-op"}})},t.handleAddToTransfer=function(e){_.logUserEventOnFile({args:e,action_type:j.WebUserActionLogEvent.ADD_TO_TRANSFER}),v.asyncShowBrowseEntryPointOnboardingModal({primaryActionOnClick:()=>{const t=e.files.toArray(),s=H.prepareFileIdsParam(t);I.Snackbar.sync(B.intl.formatMessage({id:"EmOY+w",defaultMessage:"Creating new transfer..."}),!1,"create-transfer");let a="browse";e.actionSurface&&(a=`browse_${e.actionSurface}`,e.actionSurface===j.ActionSurfaceLogValue.RIGHT_SIDEBAR&&1===t.length?a=`browse_${e.actionSurface}_single_file`:e.actionSurface===j.ActionSurfaceLogValue.RIGHT_SIDEBAR&&t.length>1&&(a=`browse_${e.actionSurface}_multi_file`)),U.redirect(H.createTransferUrlWithParams({referrer:a,fileids:s}))},userId:e.user.id})},t.handleReplay=function(e){const{files:t}=e,s=t.first(),{file_id:a}=s;U.unsafeRedirect(`https://replay.dropbox.com/project/creating/${a}?creationSource=dropbox_web`)},t.handleOpenInNewTab=function(e){const{files:t,user:s}=e,a=t.first();let r;r=a.is_dir?n.browse_uri_for_fq_path(s,a.fq_path):n.preview_uri_for_fq_path(s,a.fq_path),window.open(r.toString(),"_blank")},t.handlePreview=function(e,t){const{files:s,user:a,rightRailState:r}=e,i=s.first();if(e.isSearchMode){F.getStoreForSearch().dispatch(T.handleNavigateToFileOrFolder(i,{actionSource:t}))}else{const{ns_id:s,sjid:n,file_id:l,fq_path:c,bytes:u,ext:m,request_id:h}=i;d.logOpenRow({uid:a.id,entity_type:i.is_dir?"folder":"file",source:"list_browse",view_type:e.viewType,file_nsid:s,file_sjid:n,file_id:l,file_name:o.filename(i.fq_path),file_path:c,file_size:u,file_type:i.type,file_extension:m,request_id:h,action_source:t,rightRailState:r}),t===j.ActionSourceValue.DETAILS_PANE_PREVIEW&&d.logBrowseAction({uid:a.id,num_files_selected:1,num_folders_selected:0,action:j.WebUserActionLogEvent.THUMBNAIL_OPEN_PREVIEW,action_surface:j.ActionSurfaceLogValue.RIGHT_SIDEBAR,right_sidebar_state:"opened"}),p.browseNavigateActions.openPreviewForBrowseFile({file:i,shouldFocusComment:!1,user:a,fileViewAction:D.FileViewActionType.CLICK,fileViewOrigin:D.FileViewOriginType.BROWSE,onFileViewerUnmount:()=>{}})}},t.handleOpenInDesktopWithoutStandardHandlers=Y,t.handleOpenInDesktop=function(e,t,s,a){Y(e,e=>(t&&t(e),P.UnityFeatures.standard_open_file_handler(e)),e=>{s&&s(e),P.UnityFeatures.standard_open_file_handler(!1)},a)},t.handleShareCopyLink=function(e,t,s,r){_.logUserEventOnFile({args:e,action_type:j.WebUserActionLogEvent.SHARE_COPY_LINK}),a.CopyLinkMiniModal.show({user:e.user,file:e.files.first(),setIsCreatingSharedLink:(t,s)=>{(e.isSearchMode?F.getStoreForSearch():f.getStoreForBrowse()).dispatch({type:e.isSearchMode?L.ActionTypes.SET_IS_CREATING_SHARED_LINK:g.ActionTypes.SET_IS_CREATING_SHARED_LINK,payload:{fileIdOrPath:s,isCreatingSharedLink:t}})},userActionSource:e.actionSource,anchorRef:t,onHoverLocked:s,onActionFlowComplete:r})},t.handleShowInFolder=function(e){const{user:t,files:s}=e,a=s.map(e=>e.fq_path).toArray();_.logUserEventOnFile({args:e,action_type:j.WebUserActionLogEvent.SHOW_IN_FOLDER}),l.handleShowInFolder({fqPaths:a,user:t})},t.handleSendForSignature=function(t,a){const{files:r,user:i}=t,n=r.first();return n&&K.isBrowseFile(n)&&i?new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/integrations/hellosign_deep_integration/launcher"],t,s)}).then(s.__importStar).then(({getLauncher:e})=>{const s=e();return s.init({entryPoint:a?"file_hover_overflow_menu_self_sign":"file_hover_overflow_menu",file:n,user:i,source:a?"dropbox-file-hover-overflow-menu-send-for-self-sign":"dropbox-file-hover-overflow-menu-send-for-esign",selfSign:a}),_.logUserEventOnFile({args:t,action_type:a?j.WebUserActionLogEvent.SELF_SIGN_ENTRY_POINT:j.WebUserActionLogEvent.SEND_FOR_SIGNATURE}),s}).then(e=>(e.launch(),e)):Promise.resolve()}})),define("metaserver/static/js/browse/file_actions/actions/download",["require","exports","tslib","metaserver/static/js/modules/clean/downloads","metaserver/static/js/browse/models","metaserver/static/js/action_bar/file_actions/portable/download","metaserver/static/js/modules/clean/sync_everything/constants"],(function(e,t,s,a,r,i,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.downloadFiles=void 0,a=s.__importStar(a),t.downloadFiles=function({files:e,context:t,user:o,source:l,root_ns_id:c}){return s.__awaiter(this,void 0,void 0,(function*(){if(1===e.count()&&!e.first().is_dir&&!n.isUnmountedBackupBrowse(o,c)){const t=e.first();return void i.downloadSingleFile({href:t.href,source:l,isFswm:t instanceof r.FileSharedWithMe})}if(!t.blockHash)return;const s=t.currentFQPath,d=e.toArray().map(e=>e.fq_path);a.get_zip({fq_paths:d,subject_uid:o.id,block_hash:t.blockHash,parent_path:s,source:`${l}_zip`,root_ns_id:c})}))}})),define("metaserver/static/js/browse/file_actions/file_action_helpers",["require","exports","tslib","metaserver/static/js/browse/action_logger","metaserver/static/js/browse/logger_util","metaserver/static/js/search/single_page/data/selectors/index","metaserver/static/js/search/single_page/data/store","metaserver/static/js/search/single_page/logger","metaserver/static/js/modules/clean/web_user_action_events","metaserver/static/js/browse/models"],(function(e,t,s,a,r,i,n,o,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logUserEventOnFile=void 0,a=s.__importStar(a),r=s.__importStar(r),i=s.__importStar(i),t.logUserEventOnFile=function({args:e,action_type:t,action_source:s,action_surface:d,extra:u}){var p;const{user:m,files:h,isSearchMode:f,source:g,viewType:_,isSidebar:b}=e,{num_files_selected:y,num_folders_selected:v}=r.countFilesAndFolders(h),S=e.actionSurface?e.actionSurface:d||(b?l.ActionSurfaceLogValue.RIGHT_SIDEBAR:l.ActionSurfaceLogValue.OVERFLOW_MENU),E=e.actionSource?e.actionSource:s,w=h.first();f?o.logResultAction(t,i.resultsList(n.getStoreForSearch().getState()),w,S,E,Object.assign(Object.assign({},u),{num_files_selected:y.toString(),num_folders_selected:v.toString(),right_sidebar_state:null!==(p=e.rightRailState)&&void 0!==p?p:null})):w instanceof c.FileSharedWithMe||a.logBrowseAction({uid:m.id,source:g,action:t,num_files_selected:y,num_folders_selected:v,view_type:_,result:w,action_surface:S,action_source:E,right_sidebar_state:e.rightRailState,extra:u})}})),define("metaserver/static/js/action_bar/file_actions/portable/download",["require","exports","tslib","metaserver/static/js/modules/clean/downloads","metaserver/static/js/share_download/ui/api","spectrum-sharing/utils/sharing_constants","metaserver/static/js/modules/clean/filepath/filepath"],(function(e,t,s,a,r,i,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.downloadSingleFileAsZip=t.downloadSingleFile=void 0,a=s.__importStar(a),n=s.__importStar(n);t.downloadSingleFile=({href:e,source:t,isFswm:n=!1},{onSuccess:o}={})=>s.__awaiter(void 0,void 0,void 0,(function*(){const s=n?yield r.fetchDownloadUrl(e,void 0,i.SHARE_ACTION_ORIGIN_TYPE.PREVIEW_PAGE):e;a.get({url:s,source:`${t}_direct`}),null==o||o()}));t.downloadSingleFileAsZip=({fqPath:e,rootNsId:t,source:r,blockHash:i,user:o},{onSuccess:l}={})=>s.__awaiter(void 0,void 0,void 0,(function*(){a.get_zip({fq_paths:[e],subject_uid:o.id,block_hash:i,parent_path:n.parent_dir(e),source:r,root_ns_id:t}),null==l||l()}))})),define("metaserver/static/js/action_bar/file_actions/portable/go_to_folder",["require","exports","tslib","metaserver/static/js/modules/clean/filepath/filepath","metaserver/static/js/modules/clean/browse_interface"],(function(e,t,s,a,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.handleShowInFolder=void 0,a=s.__importStar(a);t.handleShowInFolder=({fqPaths:e,user:t})=>{if(0===e.length)return;const s=e.map(e=>a.filename(e)),i=a.parent_dir(e[0]),n=r.browse_uri_for_fq_path(t,i);s.length>1?n.updateQuery({select_multi:JSON.stringify(s)}):n.updateQuery({select:s[0]}),window.open(n.toString(),"_blank")}})),define("metaserver/static/js/file_lock/api",["require","exports","tslib","metaserver/static/js/api_v2/user_client","metaserver/static/js/browse/models","metaserver/static/js/modules/core/i18n","metaserver/static/js/modules/clean/react/snackbar","metaserver/static/js/components/modals/show_modal","metaserver/static/js/locked_files/view/modals/lock_confirm_modal","metaserver/static/js/locked_files/view/modals/request_unlock_confirm_modal","metaserver/static/js/modules/clean/filepath/filepath","metaserver/static/js/modules/core/cookies"],(function(e,t,s,a,r,i,n,o,l,c,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.showRequestUnlockConfirmModal=t.showFileLockConfirmModal=t.asyncRequestUnlockFile=t.asyncUnlockFile=t.asyncLockFile=t.showFeedbackForFileLockAction=t.unlockFailureString=t.unlockSuccessString=void 0,d=s.__importStar(d);function p(){return i.intl.formatMessage({id:"uGHYAs",defaultMessage:"Unlocked editing. Any one else with access can edit again."})}function m(){return i.intl.formatMessage({id:"v/COiN",defaultMessage:"Unlocking editing failed."})}function h(e){return{entries:e.map(e=>({path:e.fq_path}))}}function f(e){return e.result.then(t=>t.entries&&t.entries.length>0&&t.entries.every(e=>"success"===e[".tag"])?(n.Snackbar.complete(e.onSuccessMsg(t),"file-lock-status"),Promise.resolve()):Promise.reject()).catch(()=>(n.Snackbar.fail(e.onFailMsg,"file-lock-status"),Promise.reject()))}function g(e,t){return s.__awaiter(this,void 0,void 0,(function*(){const s=(new a.UserApiV2Client).ns("files").rpc("lock_file_batch",h(t),{subjectUserId:e});yield f({result:s,onSuccessMsg:e=>i.intl.formatMessage({id:"nv3jy/",defaultMessage:"Editing locked. Now only you can make changes."}),onFailMsg:i.intl.formatMessage({id:"MmwXT2",defaultMessage:"Locking editing failed."})})}))}function _(e,t){return s.__awaiter(this,void 0,void 0,(function*(){const s=r.File.getFilename(t[0]),n=t[0].lockholder_name,o=(new a.UserApiV2Client).ns("files").rpc("request_unlock_file_batch",h(t),{subjectUserId:e});yield f({result:o,onSuccessMsg:e=>{const t=e.entries[0];return t.lock&&t.lock.content&&"unlocked"===t.lock.content[".tag"]?p():i.intl.formatMessage({id:"im3MR+",defaultMessage:"Asked {name} to unlock {filename}"},{filename:s,name:n})},onFailMsg:i.intl.formatMessage({id:"i/KiYl",defaultMessage:"Error asking {name} to unlock {filename}"},{filename:s,name:n})})}))}t.unlockSuccessString=p,t.unlockFailureString=m,t.showFeedbackForFileLockAction=f,t.asyncLockFile=g,t.asyncUnlockFile=function(e,t){return s.__awaiter(this,void 0,void 0,(function*(){const s=(new a.UserApiV2Client).ns("files").rpc("unlock_file_batch",h(t),{subjectUserId:e});yield f({result:s,onSuccessMsg:e=>p(),onFailMsg:m()})}))},t.asyncRequestUnlockFile=_,t.showFileLockConfirmModal=function(e,t){const s=()=>{g(e,[t])},a=()=>{u.Cookies.create("do_not_show_lock_confirmation_dialog","true",365)};"true"===u.Cookies.read("do_not_show_lock_confirmation_dialog")?s():o.showModal(l.FileLockConfirmModal({filename:d.filename(t.fq_path),onLock:s,onNeverShowAgain:a}))},t.showRequestUnlockConfirmModal=function(e,t){void 0!==t.ts_locked&&void 0!==t.lockholder_name?o.showModal(c.RequestUnlockConfirmModal({lockCreatedTime:t.ts_locked,lockholderName:t.lockholder_name,onRequestUnlock:()=>{_(e,[t])}})):n.Snackbar.fail(i.intl.formatMessage({id:"LDj5Eu",defaultMessage:"Could not ask to unlock. Please try again later."}),"file-lock-status")}})),define("metaserver/static/js/locked_files/view/modals/lock_confirm_modal",["require","exports","tslib","react","react-intl","spectrum/modal/index","metaserver/static/js/modules/core/i18n","metaserver/static/js/modules/clean/ux_analytics/utils","metaserver/static/js/modules/clean/ux_analytics_modal_tracking","metaserver/static/js/modules/core/browser","spectrum/checkbox/index","metaserver/static/js/components/ui/css"],(function(e,t,s,a,r,i,n,o,l,c,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileLockConfirmModal=t.FileLockConfirmModalWithCSS=void 0,a=s.__importDefault(a),c=s.__importStar(c);class p extends a.default.Component{constructor(e){super(e),this.onClickCheckbox=()=>{this.setState({checkboxMarked:!this.state.checkboxMarked})},this.onRequestClose=()=>{this.setState({isModalOpen:!1}),o.dispatchModalClosed()},this.onRequestLock=()=>{this.props.onLock(),this.state.checkboxMarked&&this.props.onNeverShowAgain()},this.state={checkboxMarked:!1,isModalOpen:!0}}render(){const e=n.intl.formatMessage({id:"cRptek",defaultMessage:"Lock editing for this file?"}),t=r.defineMessage({id:"dBZbCY",defaultMessage:"Only you can make changes to <st>{path}</st> while editing is locked. Anyone else with access to the file can still view it."}),s=n.intl.formatMessage({id:"iR68zV",defaultMessage:"Lock"}),u=n.intl.formatMessage({id:"d9/SE1",defaultMessage:"Cancel"}),p=n.intl.formatMessage({id:"gk12sS",defaultMessage:"Learn more"}),m=n.intl.formatMessage({id:"s0mqEc",defaultMessage:"Don’t ask me this again"});return a.default.createElement(i.UtilityModal,{title:e,primaryAction:s,onReady:o.dispatchModalOpened,onPrimaryAction:this.onRequestLock,secondaryAction:u,onRequestClose:this.onRequestClose,ariaLabel:e,open:this.state.isModalOpen,shouldFocusAfterRender:!0,link:p,onLink:()=>{c.open_tab("https://help.dropbox.com/files-folders/share/file-locking")}},a.default.createElement(l.UXAnalyticsModalTracking,{id:"file_lock_confirm_modal"}),n.intl.formatMessage(t,{st:e=>a.default.createElement("strong",null,e),path:this.props.filename}),a.default.createElement("div",{className:"checkbox-with-label"},a.default.createElement(d.Checkbox,{checked:this.state.checkboxMarked?"checked":"unchecked",onChange:this.onClickCheckbox,id:"accept-checkbox"}),a.default.createElement("label",{className:"checkbox-with-label-label",htmlFor:"accept-checkbox"},a.default.createElement("div",null,m))))}}p.displayName="FileLockConfirmModalBase",t.FileLockConfirmModalWithCSS=u.requireCssWithComponent(p,["/static/css/file_locking/file_locking_modal-vflDp2_5Q.css"]);t.FileLockConfirmModal=({filename:e,onLock:s,onNeverShowAgain:r})=>a.default.createElement(t.FileLockConfirmModalWithCSS,{onLock:s,onNeverShowAgain:r,filename:e})})),define("metaserver/static/js/locked_files/view/modals/request_unlock_confirm_modal",["require","exports","tslib","react","react-intl","spectrum/modal/index","metaserver/static/js/modules/core/i18n","metaserver/static/js/datetime/datetime","metaserver/static/js/modules/clean/ux_analytics/utils","metaserver/static/js/modules/clean/ux_analytics_modal_tracking","metaserver/static/js/modules/core/browser"],(function(e,t,s,a,r,i,n,o,l,c,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RequestUnlockConfirmModal=void 0,a=s.__importDefault(a),d=s.__importStar(d);const u=e=>()=>{e(),l.dispatchModalClosed()};t.RequestUnlockConfirmModal=({lockCreatedTime:e,lockholderName:t,onRequestUnlock:s})=>{const p=n.intl.formatMessage({id:"yd0RsA",defaultMessage:"Editing is locked for this file"}),m=r.defineMessage({id:"iRKebb",defaultMessage:"{lockholder_name} temporarily locked editing for this file {ago}. You can view it while it’s locked, or ask them to unlock it."}),h=n.intl.formatMessage({id:"PMI4xl",defaultMessage:"Ask to unlock"}),f=n.intl.formatMessage({id:"nOO9Qi",defaultMessage:"OK"}),g=n.intl.formatMessage({id:"gk12sS",defaultMessage:"Learn more"}),_=1e3*Number(e),b=o.agoFromDate(new Date(_),new Date);return a.default.createElement(i.UtilityModal,{title:p,primaryAction:h,onReady:l.dispatchModalOpened,onPrimaryAction:u(s),secondaryAction:f,onRequestClose:l.dispatchModalClosed,ariaLabel:p,open:!0,shouldFocusAfterRender:!0,link:g,onLink:()=>{d.open_tab("https://help.dropbox.com/files-folders/share/file-locking")}},a.default.createElement(c.UXAnalyticsModalTracking,{id:"file_lock_confirm_modal"}),n.intl.formatMessage(m,{lockholder_name:t,ago:b}))}})),define("metaserver/static/js/account_page/widgets/two_step_verification/modals/flow_steps",["require","exports","tslib","jquery","react","dig-components/buttons","dig-components/text_fields","dig-components/controls","metaserver/static/js/account_page/widgets/two_step_verification/modals/phone_input","metaserver/static/js/account_page/widgets/two_step_verification/modals/twofactor_api","metaserver/static/js/deprecated_ajax/ajax_as_promised_jquery","metaserver/static/js/api_v2/user_client","metaserver/static/js/auth/authenticator","metaserver/static/js/modules/clean/react/image","metaserver/static/js/modules/clean/react/input_dig","metaserver/static/js/components/ui/modal_controller","metaserver/static/js/modules/clean/react/modal_dig","metaserver/static/js/modules/clean/static_urls","metaserver/static/js/modules/core/i18n","metaserver/static/js/modules/core/notify","jquery.qrcode"],(function(e,t,s,a,r,i,n,o,l,c,d,u,p,m,h,f,g,_,b,y){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RevokeAllTrustedDevicesModal=t.SecurityKeyRegisterModal=t.SecurityKeyIntroModal=t.FinishTwofactorDisableModal=t.FinishTwofactorEnableModal=t.EditRecoveryCodesModal=t.ViewRecoveryCodesModal=t.BackupPhoneModal=t.ConfirmDeliveryModal=t.SetupOfflineModal=t.EnterPhoneModal=t.fetchPhoneNumberConstants=t.ChooseDeliveryModal=t.ConfirmPasswordModal=t.StartModal=void 0,a=s.__importDefault(a),r=s.__importDefault(r),c=s.__importStar(c),p=s.__importStar(p),h=s.__importStar(h),f=s.__importStar(f);const v=h.password,S=b.intl.formatMessage({id:"fvZIUX",defaultMessage:"Sorry, an error occurred. Please try again later."});class E extends r.default.Component{render(){const e=this.props.acceptButtonText||b.intl.formatMessage({id:"vJgZg+",defaultMessage:"Next"});let t,s=void 0;return this.props.dismissOptions&&(t=this.props.dismissOptions.text,s=e=>{-1!==e.currentTarget.className.indexOf("dbmodal-button")&&(e.preventDefault(),this.props.dismissOptions.onDismiss())}),r.default.createElement(g.Modal,{acceptButtonText:null===this.props.onAccept?null:e,autoClose:!1,onAccept:this.props.onAccept,onDismiss:s,title:this.props.title,submitting:this.props.submitting,id:this.props.id,className:this.props.className,dismissButtonText:t,helpLink:this.props.helpLink,onShow:this.props.onShow},r.default.createElement("div",{className:"twofactor-account-form"},this.props.children,this.props.errorText&&r.default.createElement("div",{className:"error-message"},this.props.errorText)))}}E.displayName="ModalStepModal";class w extends r.default.Component{render(){return r.default.createElement(E,{id:"twofactor-start",onAccept:this.props.onConfirm,title:this.props.title,acceptButtonText:b.intl.formatMessage({id:"kOQNUE",defaultMessage:"Get started"}),helpLink:r.default.createElement("a",{className:"learn-more",href:"https://www.dropbox.com/help/363",target:"_blank",rel:"noreferrer"},b.intl.formatMessage({id:"gk12sS",defaultMessage:"Learn more"}))},r.default.createElement("p",null,b.intl.formatMessage({id:"EIHDne",defaultMessage:"Two-step verification adds an extra layer of protection to your account. Whenever you sign in to the Dropbox website or link a new device, you’ll need to enter both your password and also a security code sent to your mobile phone."})))}}t.StartModal=w,w.displayName="StartModal";class M extends r.default.Component{constructor(e){super(e),this.onAccept=()=>s.__awaiter(this,void 0,void 0,(function*(){this.setState({submitting:!0});const e=yield c.confirmPassword(this.props.user.id,this.state.password,this.props.context);if(this.setState({submitting:!1}),"success"===e.type)this.props.onSuccessfulPassword(e.checkpointToken);else if("error"===e.type)switch(e.error){case"INVALID":this.setState({error:b.intl.formatMessage({id:"l/9ohN",defaultMessage:"Invalid password"})})}else this.setState({unexpectedError:S})})),this.setPassword=e=>this.setState({password:e.currentTarget.value}),this.state={password:"",submitting:!1}}render(){return r.default.createElement(E,{id:"twofactor-enter-password",onAccept:this.onAccept,title:this.props.title,submitting:this.state.submitting,errorText:this.state.unexpectedError},r.default.createElement("p",null,b.intl.formatMessage({id:"+HVGgM",defaultMessage:"For security, please enter your password for {email}."},{email:this.props.user.email})),r.default.createElement(v,{id:"password",value:this.state.password,variant:"small",onChange:this.setPassword,error:void 0===this.state.error?void 0:{message_text:this.state.error},placeholder:b.intl.formatMessage({id:"i+PJQ7",defaultMessage:"Password"})}))}}t.ConfirmPasswordModal=M,M.displayName="ConfirmPasswordModal";class k extends r.default.Component{constructor(e){super(e),this.onAccept=()=>s.__awaiter(this,void 0,void 0,(function*(){if(this.state.usePhoneDelivery)this.props.onSelectionConfirmed({type:"phone"});else{this.setState({submitting:!0});const e=yield c.fetchOfflineKey(this.props.user.id,this.props.checkpointToken);this.setState({submitting:!1}),"success"===e.type?this.props.onSelectionConfirmed({type:"offline",offlineKey:e.b32EncodedKey}):"error"===e.type?this.props.onPasswordExpired():this.setState({unexpectedError:S})}})),this.state={usePhoneDelivery:!0,submitting:!1}}render(){const e=e=>()=>{this.setState({usePhoneDelivery:e})};return r.default.createElement(E,{title:this.props.title,submitting:this.state.submitting,onAccept:this.onAccept,id:"twofactor-delivery-choice",errorText:this.state.unexpectedError},r.default.createElement("p",null,r.default.createElement("b",null,b.intl.formatMessage({id:"6Ooe3V",defaultMessage:"How would you like to receive your security codes?"}))),r.default.createElement("div",{className:`delivery-choice ${this.state.usePhoneDelivery?"selected":""}`,id:"sms-choice"},r.default.createElement(o.RadioButton,{id:"use-sms",name:"delivery","aria-label":"Use SMS",checked:this.state.usePhoneDelivery,"aria-checked":this.state.usePhoneDelivery,onChange:e(!0),tabIndex:0}),r.default.createElement("label",{htmlFor:"use-sms"},r.default.createElement("strong",null,b.intl.formatMessage({id:"ribcyl",defaultMessage:"Use text messages"})),r.default.createElement("br",null),b.intl.formatMessage({id:"rkKFQh",defaultMessage:"Security codes will be sent to your mobile phone"}))),r.default.createElement("div",{className:`delivery-choice ${this.state.usePhoneDelivery?"":"selected"}`,id:"app-choice"},r.default.createElement(o.RadioButton,{id:"use-app",name:"delivery",type:"radio",checked:!this.state.usePhoneDelivery,"aria-checked":!this.state.usePhoneDelivery,onChange:e(!1),tabIndex:0}),r.default.createElement("label",{htmlFor:"use-app"},r.default.createElement("strong",null,b.intl.formatMessage({id:"gbLFmN",defaultMessage:"Use a mobile app"})),r.default.createElement("br",null),b.intl.formatMessage({id:"9W0BXd",defaultMessage:"Security codes will be generated by an authenticator app"}))))}}t.ChooseDeliveryModal=k,k.displayName="ChooseDeliveryModal";let A=[];function N(){return s.__awaiter(this,void 0,void 0,(function*(){try{return yield d.WebRequest({url:"/account/get_phone_input_data",dataType:"json"})}catch(e){return null}}))}t.fetchPhoneNumberConstants=N;const I=e=>{let t=[];if(e){const{country_list:s,phone_code_map:a}=e;t=s.map(e=>({countryCode:e[0],countryName:e[1],phoneCode:a[e[0]]}))}return t};class C extends r.default.Component{constructor(e){super(e),this.BAD_CARRIER=b.intl.formatMessage({id:"ffjRA4",defaultMessage:"Unfortunately, your carrier isn’t supported at this time."}),this.INVALID_NUMBER=b.intl.formatMessage({id:"ffjRA4",defaultMessage:"Unfortunately, your carrier isn’t supported at this time."}),this.NOTAMOBILE=b.intl.formatMessage({id:"ffjRA4",defaultMessage:"Unfortunately, your carrier isn’t supported at this time."}),this.UNREACHABLE=b.intl.formatMessage({id:"ffjRA4",defaultMessage:"Unfortunately, your carrier isn’t supported at this time."}),this.RATE_LIMIT=b.intl.formatMessage({id:"O7BCIr",defaultMessage:"You’ve asked for too many SMS messages. Please try again in a few minutes."}),this.onAccept=()=>s.__awaiter(this,void 0,void 0,(function*(){if(this.state.phoneNumber&&"success"===this.state.phoneNumber.type){this.setState({submitting:!0});const e=yield c.submitPhoneNumber(this.props.user.id,this.props.checkpointToken,this.state.phoneNumber.phoneNumber);if(this.setState({submitting:!1}),"success"===e.type)this.props.onAccept({phoneNumber:this.state.phoneNumber.phoneNumber,phoneSig:e.phoneSig});else if("error"===e.type){const t=e=>{this.setState({unexpectedError:e})};switch(e.error){case"EXPIRED":this.props.onPasswordExpired();break;case"UNREACHABLE":t(this.UNREACHABLE);break;case"BADCARRIER":t(this.BAD_CARRIER);break;case"INVALIDNUMBER":t(this.INVALID_NUMBER);break;case"NOTAMOBILE":t(this.NOTAMOBILE);break;case"RATELIMIT":y.Notify.error(this.RATE_LIMIT)}}else this.setState({unexpectedError:S})}})),this.setPhoneNumber=e=>this.setState({phoneNumber:e}),this.state={submitting:!1,loadedUserConstants:A}}UNSAFE_componentWillMount(){return s.__awaiter(this,void 0,void 0,(function*(){if(0===A.length){const e=yield N();if(e&&0===this.state.loadedUserConstants.length){const t=I(e);A=t,this.setState({loadedUserConstants:t})}}}))}render(){return r.default.createElement(E,{id:"twofactor-enter-phone",className:"twofactor-overflow",title:this.props.title,onAccept:this.onAccept,submitting:this.state.submitting,errorText:this.state.unexpectedError,dismissOptions:{text:b.intl.formatMessage({id:"tSs2ty",defaultMessage:"Back"}),onDismiss:this.props.onDismiss}},r.default.createElement("p",{className:"subtitle"},b.intl.formatMessage({id:"HKKwpB",defaultMessage:"Enter your mobile phone number"})),r.default.createElement("p",null,b.intl.formatMessage({id:"NvAM7e",defaultMessage:"We’ll send a security code to this phone number whenever you sign in to the Dropbox website or link a new Device."})),r.default.createElement(l.PhoneInput,{onPhoneNumberInput:this.setPhoneNumber,isLoading:0===this.state.loadedUserConstants.length,countryList:this.state.loadedUserConstants}))}}t.EnterPhoneModal=C,C.displayName="EnterPhoneModal";class R extends r.default.Component{constructor(e){super(e),this.qrCodeContainer=r.default.createRef(),this.state={showBarcode:!0}}componentDidMount(){this.setupQrCode()}componentDidUpdate(){this.setupQrCode()}componentWillUpdate(e,t){this.clearQrCode()}setupQrCode(){const e=a.default(this.qrCodeContainer.current);e.empty();const t=this.parseB32Key(this.props.totpB32Secret,!1),s={text:`otpauth://totp/Dropbox:${this.props.user.email}?secret=${t}&issuer=Dropbox`,height:200,width:200},r=document.createElement("canvas"),i=!(!r.getContext||!r.getContext("2d"));i||(s.render="table"),e.qrcode(s).show(),i||e.children("table").css("margin","0 auto")}clearQrCode(){a.default(this.qrCodeContainer.current).empty()}parseB32Key(e,t){const s=e.replace(new RegExp("=+$"),"");return t?s.toLowerCase().replace(/(.{4})/g,"$1 "):s}render(){const e=e=>()=>{this.setState({showBarcode:e})};return r.default.createElement(E,{title:this.props.title,onAccept:this.props.onAccept,id:"twofactor-offline-setup",dismissOptions:{text:b.intl.formatMessage({id:"tSs2ty",defaultMessage:"Back"}),onDismiss:this.props.onDismiss},onShow:()=>this.setupQrCode()},r.default.createElement("p",null,b.intl.formatMessage({id:"u09i+4",defaultMessage:"An authenticator app lets you generate security codes on your phone without needing to receive text messages. If you don’t already have one, we support any of <a>these apps</a>."},{a:e=>r.default.createElement("a",{href:"https://www.dropbox.com/help/363#2fa-apps",rel:"noopener noreferrer",target:"_blank"},e)})),r.default.createElement("p",null,b.intl.formatMessage({id:"b+PDmn",defaultMessage:"To configure your authenticator app:"})),r.default.createElement("ul",{className:"blue-bullets"},r.default.createElement("li",null,b.intl.formatMessage({id:"bKmf0p",defaultMessage:"Add a new time-based token."})),this.state.showBarcode?r.default.createElement("li",null,b.intl.formatMessage({id:"+kJxW6",defaultMessage:"Use your app to scan the barcode below, or <button>enter your secret key manually</button>."},{button:t=>r.default.createElement(i.Button,{variant:"transparent",onClick:e(!1)},t)})):r.default.createElement("li",null,b.intl.formatMessage({id:"LzEh8h",defaultMessage:"Enter the secret key below, or <button>scan a barcode instead</button>."},{button:t=>r.default.createElement(i.Button,{variant:"transparent",onClick:e(!0)},t)}))),this.state.showBarcode?r.default.createElement("div",{id:"qr-div",ref:this.qrCodeContainer}):r.default.createElement("div",{id:"secret-div"},this.parseB32Key(this.props.totpB32Secret,!0)))}}t.SetupOfflineModal=R,R.displayName="SetupOfflineModal";class T extends r.default.Component{constructor(e){super(e),this.INVALID_CODE_GENERAL=b.intl.formatMessage({id:"LGWy5v",defaultMessage:"Invalid code."}),this.INVALID_CODE_TOTP=b.intl.formatMessage({id:"PEgSVc",defaultMessage:"Invalid code. Check the clock on your phone: it must be accurate to the minute."}),this.bindToInput=e=>t=>{this.setState(Object.assign(Object.assign({},this.state),{[e]:t.currentTarget.value}))},this.onAccept=()=>s.__awaiter(this,void 0,void 0,(function*(){this.setState({submitting:!0});const e="phone"===this.props.deliveryDetails.type?this.props.deliveryDetails.phoneData.phoneSig:void 0,t=yield c.confirmCode(this.props.user.id,this.props.checkpointToken,this.state.code,e);if(this.setState({submitting:!1}),"success"===t.type)this.props.onSuccessfulConfirm(t.backupCodes);else if("error"===t.type)switch(t.error){case"EXPIRED":this.props.onPasswordExpired();break;case"INVALID":const e=this.state.invalidCodeAttempts+1;0===this.state.invalidCodeAttempts||"phone"===this.props.deliveryDetails.type?this.setState({unexpectedError:this.INVALID_CODE_GENERAL,invalidCodeAttempts:e}):this.setState({unexpectedError:this.INVALID_CODE_TOTP,invalidCodeAttempts:e});break;case"RATELIMIT":y.Notify.error(b.intl.formatMessage({id:"kU4PMt",defaultMessage:"Too many invalid codes. Try again in a few minutes."}))}else this.setState({unexpectedError:S})})),this.state={submitting:!1,invalidCodeAttempts:0,code:""}}render(){return"phone"===this.props.deliveryDetails.type?(e=>r.default.createElement(E,{title:this.props.title,onAccept:this.onAccept,submitting:this.state.submitting,id:"twofactor-enable-confirm",errorText:this.state.unexpectedError,dismissOptions:{text:b.intl.formatMessage({id:"tSs2ty",defaultMessage:"Back"}),onDismiss:this.props.onDismiss}},r.default.createElement("p",null,b.intl.formatMessage({id:"HONi9s",defaultMessage:"We sent a security code to {phone_number}. Enter it below to verify your phone number"},{phone_number:e})),r.default.createElement("div",{className:"twofactor-input-wrapper"},r.default.createElement(n.TextInput,{id:"phone-code",value:this.state.code,onChange:this.bindToInput("code"),placeholder:b.intl.formatMessage({id:"DFLqLE",defaultMessage:"6-digit code"})}))))(this.props.deliveryDetails.phoneData.phoneNumber):(()=>r.default.createElement(E,{title:this.props.title,onAccept:this.onAccept,submitting:this.state.submitting,id:"twofactor-enable-confirm",errorText:this.state.unexpectedError,dismissOptions:{text:b.intl.formatMessage({id:"tSs2ty",defaultMessage:"Back"}),onDismiss:this.props.onDismiss}},r.default.createElement("p",null,b.intl.formatMessage({id:"lG9gS/",defaultMessage:"Enter the security code generated by your mobile authenticator app to make sure it’s configured correctly."})),r.default.createElement("div",{className:"twofactor-input-wrapper"},r.default.createElement(n.TextInput,{id:"phone-code",value:this.state.code,onChange:this.bindToInput("code"),placeholder:b.intl.formatMessage({id:"DFLqLE",defaultMessage:"6-digit code"})}))))()}}t.ConfirmDeliveryModal=T,T.displayName="ConfirmDeliveryModal";class F extends r.default.Component{constructor(e){super(e),this.SAME_AS_PRIMARY_ERROR=b.intl.formatMessage({id:"yJcqG4",defaultMessage:"You can’t use your primary phone as your backup"}),this.numberIsSameAsPrimary=()=>{const e=this.state.backupPhoneNumber,t=e&&"success"===e.type?e.phoneNumber:void 0;return t&&this.props.primaryPhone&&t===this.props.primaryPhone},this.onAccept=()=>s.__awaiter(this,void 0,void 0,(function*(){if(this.numberIsSameAsPrimary())return;const e=this.state.backupPhoneNumber,t=e&&"success"===e.type?e.phoneNumber:void 0;if("edit_backup_phone"===this.props.flow){this.setState({submitting:!0});const e=yield c.addBackupPhone(this.props.user.id,this.props.checkpointToken,t);this.setState({submitting:!1}),"success"===e.type?this.props.onAccept(t):"error"===e.type?this.props.onPasswordExpired():this.setState({unexpectedError:S})}else if("edit_twofactor"===this.props.flow){this.setState({submitting:!0});const e=yield c.enableTwofactorFinish(this.props.user.id,this.props.checkpointToken,t||null);if(this.setState({submitting:!1}),"success"===e.type)this.props.onAccept(t);else if("error"===e.type)switch(e.error){case"EXPIRED":this.props.onPasswordExpired()}else this.setState({unexpectedError:S})}else this.props.onAccept(t)})),this.setBackupPhoneNumber=e=>this.setState({backupPhoneNumber:e}),this.state={submitting:!1,isSameAsPrimary:!1,loadedUserConstants:A}}UNSAFE_componentWillMount(){return s.__awaiter(this,void 0,void 0,(function*(){if(0===A.length){const e=yield N();if(e&&0===this.state.loadedUserConstants.length){const t=I(e);A=t,this.setState({loadedUserConstants:t})}}}))}render(){const e=this.numberIsSameAsPrimary()&&this.SAME_AS_PRIMARY_ERROR;return r.default.createElement(E,{title:this.props.title,onAccept:this.onAccept,submitting:this.state.submitting,id:"twofactor-enter-backup-phone",className:"twofactor-overflow",errorText:e||this.state.unexpectedError,dismissOptions:{text:b.intl.formatMessage({id:"tSs2ty",defaultMessage:"Back"}),onDismiss:this.props.onDismiss}},r.default.createElement("p",{className:"subtitle"},b.intl.formatMessage({id:"PVsh9/",defaultMessage:"<strong>Backup phone number</strong> (optional)"},{strong:e=>r.default.createElement("strong",null,e)})),r.default.createElement("p",null,b.intl.formatMessage({id:"MLWfyM",defaultMessage:"If you lose access to your primary security code source, we can send them to your backup mobile number instead."})),r.default.createElement(l.PhoneInput,{onPhoneNumberInput:this.setBackupPhoneNumber,isLoading:0===this.state.loadedUserConstants.length,countryList:this.state.loadedUserConstants}),r.default.createElement("p",{id:"backup-phone-number-description"},b.intl.formatMessage({id:"djBo1i",defaultMessage:"While this step is optional, we encourage you to set up a backup phone number in case you lose your mobile phone or are otherwise unable to receive your security code."})))}}function L(e){return e.toLowerCase().replace(/(.{4})/g,"$1 ")}t.BackupPhoneModal=F,F.displayName="BackupPhoneModal";class x extends r.default.Component{constructor(e){super(e),this.onAccept=()=>s.__awaiter(this,void 0,void 0,(function*(){this.setState({submitting:!0});const e=yield c.enableTwofactorFinish(this.props.user.id,this.props.checkpointToken,this.props.backupPhone||null);if(this.setState({submitting:!1}),"success"===e.type)this.props.onAccept();else if("error"===e.type)switch(e.error){case"EXPIRED":this.props.onPasswordExpired()}else this.setState({unexpectedError:S})})),this.state={submitting:!1}}render(){const e=void 0!==this.props.primaryPhone?b.intl.formatMessage({id:"HyWjj5",defaultMessage:"Your security codes will be sent by text message"}):b.intl.formatMessage({id:"bQoyjz",defaultMessage:"Your security codes will be generated by your authenticator app"});return r.default.createElement(E,{title:this.props.title,onAccept:this.onAccept,submitting:this.state.submitting,id:"twofactor-recovery",errorText:this.state.unexpectedError,dismissOptions:{text:b.intl.formatMessage({id:"tSs2ty",defaultMessage:"Back"}),onDismiss:this.props.onDismiss}},r.default.createElement("div",{className:"deliveryLabel"},e),r.default.createElement("div",{className:"confirm-phones-outer"},this.props.primaryPhone&&r.default.createElement("div",{id:"confirm-phone-primary",className:"confirm-phones-inner"},r.default.createElement("span",{className:"confirm-phone-label"},b.intl.formatMessage({id:"9m9zTf",defaultMessage:"Primary phone number"})),r.default.createElement("span",{id:"confirm-phone-primary-number",className:"confirm-phone-number"},this.props.primaryPhone)),this.props.backupPhone&&r.default.createElement("div",{id:"confirm-phone-backup",className:"confirm-phones-inner"},r.default.createElement("span",{className:"confirm-phone-label"},b.intl.formatMessage({id:"4KZf0Q",defaultMessage:"Backup phone number"})),r.default.createElement("span",{id:"confirm-phone-backup-number",className:"confirm-phone-number"},this.props.backupPhone))),r.default.createElement("div",{className:"codesbox"},r.default.createElement("p",{className:"desc"},b.intl.formatMessage({id:"zSj4X8",defaultMessage:"You can use these one-time backup codes to access your account."})),r.default.createElement("div",{id:"backup-code-list-container"},r.default.createElement("ol",{className:"twofactor-backup-list"},this.props.recoveryCodes.map(e=>r.default.createElement("li",{className:"twofactor-backup-list__item"},r.default.createElement("span",{className:"twofactor-backup-list__code"},L(e)))))),r.default.createElement("p",{className:"sub-desc"},b.intl.formatMessage({id:"Lb5frQ",defaultMessage:"Write these down and keep them safe."}))))}}t.ViewRecoveryCodesModal=x,x.displayName="ViewRecoveryCodesModal";class P extends r.default.Component{constructor(e){super(e),this.loadRecoveryCodes=e=>s.__awaiter(this,void 0,void 0,(function*(){this.setState({submitting:!0});const t=yield c.getRecoveryCodes(this.props.user.id,this.props.checkpointToken,e);if(this.setState({submitting:!1}),"success"===t.type)this.setState({backupCodes:t.backupCodes});else if("error"===t.type)switch(t.error){case"EXPIRED":this.props.onPasswordExpired()}else this.setState({unexpectedError:S})})),this.state={submitting:!1}}componentWillMount(){return s.__awaiter(this,void 0,void 0,(function*(){this.loadRecoveryCodes(!1)}))}render(){const{backupCodes:e}=this.state;return r.default.createElement(E,{title:this.props.title,onAccept:this.props.onClose,acceptButtonText:b.intl.formatMessage({id:"nOO9Qi",defaultMessage:"OK"}),dismissOptions:{text:b.intl.formatMessage({id:"rnNUn1",defaultMessage:"Generate new codes"}),onDismiss:()=>this.loadRecoveryCodes(!0)},id:"twofactor-recovery-edit",submitting:this.state.submitting,errorText:this.state.unexpectedError},(e=>e?r.default.createElement("div",{className:"codesbox"},r.default.createElement("p",{className:"desc"},b.intl.formatMessage({id:"zSj4X8",defaultMessage:"You can use these one-time backup codes to access your account."})),r.default.createElement("div",{id:"backup-code-list-container"},r.default.createElement("ol",{className:"twofactor-backup-list"},e.map(e=>r.default.createElement("li",{className:"twofactor-backup-list__item"},r.default.createElement("span",{className:"twofactor-backup-list__code"},L(e)))))),r.default.createElement("p",{className:"sub-desc"},b.intl.formatMessage({id:"Lb5frQ",defaultMessage:"Write these down and keep them safe."}))):r.default.createElement(m.Image,{src:_.static_url("/static/images/icons/ajax-loading-small-blue-vflVk_QNP.gif"),alt:b.intl.formatMessage({id:"jybGUg",defaultMessage:"Loading"})}))(e))}}t.EditRecoveryCodesModal=P,P.displayName="EditRecoveryCodesModal";class O extends r.default.Component{render(){return r.default.createElement(E,{title:this.props.title,onAccept:this.props.onAccept,id:"twofactor-done"},r.default.createElement("p",null,b.intl.formatMessage({id:"4cZi/F",defaultMessage:"From now on, when you sign in to the Dropbox website or link a new device, you’ll need to enter a security code from your phone."})))}}t.FinishTwofactorEnableModal=O,O.displayName="FinishTwofactorEnableModal";class j extends r.default.Component{constructor(e){super(e),this.onAccept=()=>s.__awaiter(this,void 0,void 0,(function*(){this.setState({submitting:!0});const e=yield c.disableTwofactor(this.props.user.id,this.props.checkpointToken);if(this.setState({submitting:!1}),"success"===e.type)this.props.onAccept();else if("error"===e.type)switch(e.error){case"EXPIRED":this.props.onPasswordExpired()}else this.setState({unexpectedError:S})})),this.state={submitting:!1}}render(){return r.default.createElement(E,{title:this.props.title,onAccept:this.onAccept,submitting:this.state.submitting,id:"twofactor-disable",errorText:this.state.unexpectedError},r.default.createElement("p",null,b.intl.formatMessage({id:"wAS6mz",defaultMessage:"If you disable two-step verification, you’ll only need your email and password when you sign in to the Dropbox website or link a new device."})))}}t.FinishTwofactorDisableModal=j,j.displayName="FinishTwofactorDisableModal";class D extends r.default.Component{constructor(e){super(e),this.UNSUPPORTED_U2F_ERROR_STRING=b.intl.formatMessage({id:"nr9Ux4",defaultMessage:"Currently, security keys are only supported with Google Chrome, version 38 or higher."}),this.UNSUPPORTED_ERROR_STRING=b.intl.formatMessage({id:"oHNNG5",defaultMessage:"Currently, security keys are only supported with Google Chrome, version 38 or higher, and Firefox, version 60 or higher."}),this.onAccept=()=>{this.state.unsupportedBrowser?f.unmountModal():this.props.onAccept()},this.state={submitting:!0,unsupportedBrowser:!1,unsupportedErrorText:this.UNSUPPORTED_U2F_ERROR_STRING}}componentDidMount(){return s.__awaiter(this,void 0,void 0,(function*(){let e;try{if(e=yield c.startSecurityKeyRegistration(this.props.user.id),"unknown_error"===e.type)throw e}catch(e){return this.setState({submitting:!1,unsupportedBrowser:!0,unsupportedErrorText:this.UNSUPPORTED_U2F_ERROR_STRING}),void this.props.onGetRequest()}const t=!p.canRegisterAuthenticator(e.request);let s=this.UNSUPPORTED_U2F_ERROR_STRING;p.isWebAuthnEnabled(e.request)&&(s=this.UNSUPPORTED_ERROR_STRING),this.setState({submitting:!1,unsupportedBrowser:t,unsupportedErrorText:s}),this.props.onGetRequest(e)}))}render(){const e=this.state.unsupportedBrowser?this.state.unsupportedErrorText:"";return r.default.createElement(E,{title:this.props.title,id:"twofactor-security-key-unsupported-browser",onAccept:this.onAccept,errorText:e,acceptButtonText:this.state.unsupportedBrowser?b.intl.formatMessage({id:"6bRQ0U",defaultMessage:"Done"}):b.intl.formatMessage({id:"6fTvLO",defaultMessage:"Begin setup"}),submitting:this.state.submitting},r.default.createElement("div",{className:"modal-img"},r.default.createElement(m.Image,{src:_.static_url("/static/images/security_keys/insert-vflkCfC4_.png"),srcHiRes:_.static_url("/static/images/security_keys/insert@2x-vflTxG2RJ.png")})),r.default.createElement("div",{className:"instructions"},r.default.createElement("p",null,b.intl.formatMessage({id:"mgikY5",defaultMessage:"A security key allows you to complete two-step verification securely and conveniently, when logging into Dropbox. <a>Learn more</a>"},{a:e=>r.default.createElement("a",{href:"/help/363#2fa-security-keys",rel:"noopener noreferrer",target:"_blank"},e)}))))}}t.SecurityKeyIntroModal=D,D.displayName="SecurityKeyIntroModal";class U extends r.default.Component{constructor(e){super(e),this.onPrepareAccept=()=>s.__awaiter(this,void 0,void 0,(function*(){this.setState({registrationStatus:"pending_registration"})})),this.onAuthenticatorCallback=e=>s.__awaiter(this,void 0,void 0,(function*(){this.setState({submitting:!0});const t=yield c.finishSecurityKeyRegistration(this.props.user.id,this.props.checkpointToken,e);this.setState({submitting:!1}),"success"===t.type?(this.props.onKeyAdded(),this.setState({registrationStatus:"success",deviceGid:t.data.device_gid})):"error"===t.type?this.setState({registrationStatus:"error",unexpectedError:t.localizedError}):this.setState({registrationStatus:"error"})})),this.renderPrepare=()=>r.default.createElement(E,{title:this.props.title,onAccept:this.onPrepareAccept,acceptButtonText:b.intl.formatMessage({id:"cTRGoc",defaultMessage:"Key inserted"}),submitting:this.state.submitting,errorText:this.state.unexpectedError},r.default.createElement("div",{className:"modal-img"},r.default.createElement(m.Image,{src:_.static_url("/static/images/security_keys/insert-vflkCfC4_.png"),srcHiRes:_.static_url("/static/images/security_keys/insert@2x-vflTxG2RJ.png")})),r.default.createElement("div",{className:"instructions"},r.default.createElement("p",null,b.intl.formatMessage({id:"3Ol37w",defaultMessage:"Start by inserting your security key into a USB port. <a>Learn more</a>"},{a:e=>r.default.createElement("a",{href:"/help/363#2fa-security-keys",rel:"noopener noreferrer",target:"_blank"},e)})))),this.renderPending=()=>r.default.createElement(E,{title:this.props.title,errorText:this.state.unexpectedError},r.default.createElement("div",{className:"modal-img"},r.default.createElement(m.Image,{src:_.static_url("/static/images/security_keys/detect-vflwOn2Nf.png"),srcHiRes:_.static_url("/static/images/security_keys/detect@2x-vflx2BPRH.png")})),r.default.createElement("div",{className:"instructions"},r.default.createElement("p",null,r.default.createElement(m.Image,{src:_.static_url("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),className:"scanning-wheel"}),b.intl.formatMessage({id:"tq1aa1",defaultMessage:"Scanning for security key"})),r.default.createElement("p",null,b.intl.formatMessage({id:"e8eCgM",defaultMessage:"If your key has a button or a gold disk, tap it now. <a>Learn more</a>"},{a:e=>r.default.createElement("a",{href:"/help/363#2fa-security-keys",rel:"noopener noreferrer",target:"_blank"},e)})))),this.retryRegister=()=>{this.setState({registrationStatus:"pending_registration"})},this.renderError=()=>r.default.createElement(E,{title:this.props.title,onAccept:this.retryRegister,acceptButtonText:b.intl.formatMessage({id:"n1zYou",defaultMessage:"Retry"}),errorText:this.state.unexpectedError},r.default.createElement("div",{className:"modal-img"},r.default.createElement(m.Image,{src:_.static_url("/static/images/security_keys/detect-vflwOn2Nf.png"),srcHiRes:_.static_url("/static/images/security_keys/detect@2x-vflx2BPRH.png")})),r.default.createElement("div",{className:"instructions"},r.default.createElement("p",null,b.intl.formatMessage({id:"50+STL",defaultMessage:"Re-insert your key and click ‘Retry’"})))),this.setNickname=e=>this.setState({nickname:e.currentTarget.value}),this.renameAndFinish=()=>{if(this.state.nickname){this.setState({renameSubmitting:!0}),(new u.UserApiV2Client).ns("security_settings").rpc("rename_auth_device_v2",{device_gid:this.state.deviceGid,nickname:this.state.nickname},{subjectUserId:this.props.user.id}).then(e=>{this.setState({renameSubmitting:!1}),this.props.onKeyAdded(),this.props.onFinish()},e=>{this.setState({renameSubmitting:!1}),this.props.onFinish()})}else this.props.onFinish()},this.state={submitting:!1,renameSubmitting:!1,registrationStatus:"prepare",deviceGid:"",nickname:""},this.currentRequest=this.props.request}componentDidUpdate(e,t){return s.__awaiter(this,void 0,void 0,(function*(){if(t.registrationStatus!==this.state.registrationStatus&&"pending_registration"===this.state.registrationStatus)if(void 0===this.currentRequest&&(this.setState({submitting:!0}),this.currentRequest=yield c.startSecurityKeyRegistration(this.props.user.id,this.props.checkpointToken),this.setState({submitting:!1})),"success"===this.currentRequest.type){const e=yield p.register(this.currentRequest.request);this.currentRequest=void 0,this.onAuthenticatorCallback(e)}else this.setState({registrationStatus:"error",unexpectedError:S})}))}renderSuccess(){return r.default.createElement(E,{title:this.props.title,acceptButtonText:b.intl.formatMessage({id:"t0ve6c",defaultMessage:"Finish"}),onAccept:this.renameAndFinish,submitting:this.state.renameSubmitting},r.default.createElement("div",{className:"modal-img"},r.default.createElement(m.Image,{src:_.static_url("/static/images/security_keys/success-vfldNQ5IO.png"),srcHiRes:_.static_url("/static/images/security_keys/success@2x-vflv-3UZY.png")})),r.default.createElement("div",{className:"instructions"},r.default.createElement("p",null,b.intl.formatMessage({id:"qAhMHO",defaultMessage:"Key added!"})),r.default.createElement("p",null,b.intl.formatMessage({id:"FvQTeI",defaultMessage:"You can now use your security key to complete two-step verification when you sign into Dropbox."})),r.default.createElement("p",null,b.intl.formatMessage({id:"/8wKhI",defaultMessage:"If you’d like, you can also set a nickname for this security key, so that it’s easier to tell apart from any other key you have."}))),r.default.createElement(n.TextInput,{id:"nickname",value:this.state.nickname,onChange:this.setNickname,"disable-errors":!0,placeholder:b.intl.formatMessage({id:"J/uM6N",defaultMessage:"for example, ‘yellow USB key’"}),maxLength:100}))}render(){switch(this.state.registrationStatus){case"prepare":return this.renderPrepare();case"pending_registration":return this.renderPending();case"error":return this.renderError();case"success":return this.renderSuccess()}}}t.SecurityKeyRegisterModal=U,U.displayName="SecurityKeyRegisterModal";class B extends r.default.Component{constructor(e){super(e),this.onAccept=()=>s.__awaiter(this,void 0,void 0,(function*(){this.setState({submitting:!0});const e=yield c.revokeAllTrustedDevices(this.props.user.id,this.props.checkpointToken);if(this.setState({submitting:!1}),"success"===e.type)this.props.onAccept();else if("error"===e.type)switch(e.error){case"EXPIRED":this.props.onPasswordExpired()}else this.setState({unexpectedError:S})})),this.state={submitting:!1}}render(){return r.default.createElement(E,{title:this.props.title,acceptButtonText:b.intl.formatMessage({id:"nOO9Qi",defaultMessage:"OK"}),onAccept:this.onAccept,dismissOptions:{text:b.intl.formatMessage({id:"d9/SE1",defaultMessage:"Cancel"}),onDismiss:this.props.onDismiss},id:"twofactor-revoke-all-trusted-devices",submitting:this.state.submitting,errorText:this.state.unexpectedError},r.default.createElement("p",null,b.intl.formatMessage({id:"B7S5UI",defaultMessage:"To sign in again you’ll need your phone or a backup option for the second step."})))}}t.RevokeAllTrustedDevicesModal=B,B.displayName="RevokeAllTrustedDevicesModal"})),define("metaserver/static/js/account_page/widgets/two_step_verification/modals/phone_input",["require","exports","tslib","react","styled-components","metaserver/static/js/modules/constants/viewer","metaserver/static/js/modules/core/i18n","metaserver/static/js/modules/clean/static_urls","metaserver/static/js/modules/clean/react/select","metaserver/static/js/modules/clean/react/input_dig","phone_helpers"],(function(e,t,s,a,r,i,n,o,l,c,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PhoneInput=void 0,a=s.__importDefault(a),r=s.__importDefault(r),i=s.__importStar(i),l=s.__importStar(l),c=s.__importStar(c),d=s.__importStar(d);const u=c.text,p=l.input,m=l.option,h=r.default(p)`
  .select-input-input {
    padding: 0 6px !important;
  }
`,f=r.default.div`
  .phone-text {
    padding-bottom: 13px;
  }
`,g=r.default(m)`
  &&&& {
    vertical-align: baseline;
  }
`;class _ extends a.default.Component{constructor(e){super(e),this.getFullNumber=()=>d.full_number(this.state.selectedCountryCode,this.state.phoneNumber),this.getCountryIso=()=>d.iso_to_dialing(this.state.selectedCountryCode),this.getExampleNumber=()=>d.get_example_mobile_number(this.getCountryIso()),this.onCountrySelected=(e,t)=>{this.setState({selectedCountryCode:t})},this.bindToInput=e=>t=>{this.setState(Object.assign(Object.assign({},this.state),{[e]:t.currentTarget.value}))},this.state={selectedCountryCode:i.LOCALE||"US",phoneNumber:""}}componentDidUpdate(e,t){this.state.selectedCountryCode===t.selectedCountryCode&&this.state.phoneNumber===t.phoneNumber||this.notifyListenerOfPhoneInput()}notifyListenerOfPhoneInput(){this.getFullNumber()?d.is_valid(this.getFullNumber())?this.props.onPhoneNumberInput({type:"success",phoneNumber:this.getFullNumber()}):this.props.onPhoneNumberInput({type:"error"}):this.props.onPhoneNumberInput({type:"empty"})}renderCountryList(){return a.default.createElement(h,{onChange:this.onCountrySelected,value:this.state.selectedCountryCode,className:"phone-country",variant:"small"},this.props.countryList.map(e=>a.default.createElement(g,{key:e.countryCode,value:e.countryCode},e.countryName," ",e.phoneCode)))}renderLoading(){return a.default.createElement("img",{src:o.static_url("/static/images/icons/ajax-loading-small-blue-vflVk_QNP.gif"),alt:n.intl.formatMessage({id:"jybGUg",defaultMessage:"Loading"})})}render(){if(this.props.isLoading)return this.renderLoading();const e=d.format(this.getCountryIso(),this.state.phoneNumber),t=!this.state.phoneNumber||d.is_valid(this.getFullNumber());return a.default.createElement(f,{className:"phone-number-input phone-number-input-inline"},a.default.createElement("div",{className:"phone-number-error-wrapper"},a.default.createElement("div",{className:"phone-number-error error-message"}," ")),this.renderCountryList(),a.default.createElement(u,{placeholder:this.getExampleNumber(),className:"phone-text",inline:!0,variant:"small",onChange:this.bindToInput("phoneNumber"),value:e,error:t?void 0:{message_text:n.intl.formatMessage({id:"Q8gucb",defaultMessage:"Invalid phone number"})}}))}}t.PhoneInput=_,_.displayName="PhoneInput"})),define("metaserver/static/js/account_page/widgets/two_step_verification/modals/twofactor_api",["require","exports","tslib","metaserver/static/js/deprecated_ajax/ajax_as_promised_jquery","metaserver/static/js/auth/authenticator"],(function(e,t,s,a,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.revokeAllTrustedDevices=t.finishSecurityKeyRegistration=t.startSecurityKeyRegistration=t.getRecoveryCodes=t.disableTwofactor=t.enableTwofactorFinish=t.addBackupPhone=t.confirmCode=t.submitPhoneNumber=t.fetchOfflineKey=t.confirmPassword=void 0,r=s.__importStar(r);const i={type:"unknown_error"};t.confirmPassword=function(e,t,r){return s.__awaiter(this,void 0,void 0,(function*(){try{let s;s="enable"===r?"/account/twofactor/confirm_password":"disable"===r?"/account/twofactor/disable_confirm_password":"/account/twofactor/edit_confirm_password";const i=yield a.WebRequest({url:s,data:{password:t},subject_user:e});if(i.startsWith("OK:"))return{type:"success",checkpointToken:i.substring(3)};switch(i){case"EXPIRED_PASSWORD":case"INVALID":case"RATELIMIT":case"ALREADY_ENABLED":case"ALREADY_DISABLED":return{type:"error",error:i}}}catch(e){}return i}))},t.fetchOfflineKey=function(e,t){return s.__awaiter(this,void 0,void 0,(function*(){try{const s=yield a.WebRequest({url:"/account/twofactor/add_phone",data:{checkpoint_token:t,offline:!0},subject_user:e});if(s.startsWith("OK:"))return{type:"success",b32EncodedKey:s.substring(3)};if("EXPIRED"===s)return{type:"error",error:"EXPIRED"}}catch(e){}return i}))},t.submitPhoneNumber=function(e,t,r){return s.__awaiter(this,void 0,void 0,(function*(){try{const s=yield a.WebRequest({url:"/account/twofactor/add_phone",data:{checkpoint_token:t,phone_number:r},subject_user:e});if(s.startsWith("OK:")){return{type:"success",phoneSig:s.substring(3)}}switch(s){case"EXPIRED":case"UNREACHABLE":case"BADCARRIER":case"INVALIDNUMBER":case"NOTAMOBILE":case"RATELIMIT":return{type:"error",error:s}}}catch(e){}return i}))},t.confirmCode=function(e,t,r,n){return s.__awaiter(this,void 0,void 0,(function*(){try{const s=yield a.WebRequest({url:"/account/twofactor/confirm_phone",data:{checkpoint_token:t,twofactor_code:r,phone_sig:n},subject_user:e}),i=JSON.parse(s);if("OK"===i.result)return{type:"success",backupCodes:i.codes};switch(i.result){case"INVALID":case"EXPIRED":case"RATELIMIT":return{type:"error",error:i.result}}}catch(e){}return i}))},t.addBackupPhone=function(e,t,r){return s.__awaiter(this,void 0,void 0,(function*(){try{const s=yield a.WebRequest({url:"/account/twofactor/set_backup_phone",data:{checkpoint_token:t,backup_phone_number:r||""},subject_user:e});if("OK"===s)return{type:"success"};if("EXPIRED"===s)return{type:"error",error:s}}catch(e){}return i}))},t.enableTwofactorFinish=function(e,t,r){return s.__awaiter(this,void 0,void 0,(function*(){try{const s={checkpoint_token:t};null!==r&&(s.backup_phone_number=r);const i=yield a.WebRequest({url:"/account/twofactor/enable_finish",data:s,subject_user:e});if("OK"===i)return{type:"success"};if("EXPIRED"===i)return{type:"error",error:"EXPIRED"}}catch(e){}return i}))},t.disableTwofactor=function(e,t){return s.__awaiter(this,void 0,void 0,(function*(){try{const s=yield a.WebRequest({url:"/account/twofactor/disable",data:{checkpoint_token:t},subject_user:e});if("OK"===s)return{type:"success"};if("EXPIRED"===s)return{type:"error",error:"EXPIRED"}}catch(e){}return i}))},t.getRecoveryCodes=function(e,t,r){return s.__awaiter(this,void 0,void 0,(function*(){try{const s=r?"/account/twofactor/new_rescue_code":"/account/twofactor/get_rescue_code",i=yield a.WebRequest({url:s,data:{checkpoint_token:t,user_json:!0},dataType:"json",subject_user:e});if("OK"===i.result)return{type:"success",backupCodes:i.codes};if("EXPIRED"===i.result)return{type:"error",error:"EXPIRED"}}catch(e){}return i}))},t.startSecurityKeyRegistration=function(e,t){return s.__awaiter(this,void 0,void 0,(function*(){try{const s=yield a.WebRequest({url:"/account/twofactor/u2f_start_registration",data:{checkpoint_token:t},subject_user:e}),n=JSON.parse(s),o={challenge_id:n.challenge_id};for(const e of Object.keys(r.PROTOCOLS))o[e]=n[e]&&JSON.parse(n[e]);return Object.keys(o).length>0?{type:"success",request:o}:i}catch(e){return i}}))},t.finishSecurityKeyRegistration=function(e,t,r){return s.__awaiter(this,void 0,void 0,(function*(){try{const s=yield a.WebRequest({url:"/account/twofactor/u2f_finish_registration",data:{checkpoint_token:t,device_response:JSON.stringify(r)},subject_user:e});return s.startsWith("err:")?{type:"error",localizedError:JSON.parse(s.substring("err:".length)).security_key_register.message_text}:{type:"success",data:JSON.parse(s)}}catch(e){return i}}))},t.revokeAllTrustedDevices=function(e,t){return s.__awaiter(this,void 0,void 0,(function*(){try{const s="/account/twofactor/revoke_all_trusted_devices",r=yield a.WebRequest({url:s,data:{checkpoint_token:t},subject_user:e});if("OK"===r)return{type:"success"};if("EXPIRED"===r)return{type:"error",error:"EXPIRED"}}catch(e){}return i}))}})),define("metaserver/static/js/admin/ui/teams/onboarding/web/components/send_mobile_link",["require","exports","tslib","react","react-intl","dig-components/buttons","dig-components/icons","dig-components/icons/src","dig-components/progress_indicators","dig-components/tabs","dig-components/text_fields","dig-components/typography","metaserver/static/js/modules/clean/static_urls","metaserver/static/js/account_page/widgets/two_step_verification/modals/flow_steps","metaserver/static/js/deprecated_ajax/ajax_as_promised_jquery","metaserver/static/js/modules/clean/analytics","metaserver/static/js/growth/smb_funnel/smb_funnel_logger","metaserver/static/js/growth/ui/send_app_link_form","metaserver/static/js/growth/ui/send_app_link_form_disclaimer","metaserver/static/js/admin/ui/teams/onboarding/web/constants","metaserver/static/js/growth/ui/personalization/download_app_zone/messages","metaserver/static/js/modules/core/i18n","metaserver/static/js/modules/core/notify","metaserver/static/js/components/ui/css","metaserver/static/js/api_v2/default_user_client","metaserver/static/js/growth/ui/open_in_util"],(function(e,t,s,a,r,i,n,o,l,c,d,u,p,m,h,f,g,_,b,y,v,S,E,w,M,k){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SendMobileLink=t.usePhoneNumberConstants=void 0,a=s.__importStar(a);const A=r.defineMessage({id:"GU8La8",defaultMessage:"Link sent to {email}"}),N=r.defineMessage({id:"93LvA5",defaultMessage:"There was an error sending the link"}),I={EMAIL:{id:"email",label:S.intl.formatMessage({id:"Jf36zT",defaultMessage:"By email"}),content:S.intl.formatMessage({id:"5ZXdxv",defaultMessage:"We'll send a link to:"}),buttonText:S.intl.formatMessage({id:"JuuMAX",defaultMessage:"Email me the link"})},PHONE:{id:"phone",label:S.intl.formatMessage({id:"DVUAxh",defaultMessage:"By text"}),content:S.intl.formatMessage({id:"OeOpuZ",defaultMessage:"We'll send a link to:"}),buttonText:S.intl.formatMessage({id:"6sVXnz",defaultMessage:"Text me the link"})},QR:{id:"qr",label:S.intl.formatMessage({id:"Y+Foy6",defaultMessage:"QR code"}),content:S.intl.formatMessage({id:"heeSqP",defaultMessage:"Point your camera at the QR code to download Dropbox."}),buttonText:""}},C=p.static_url("/static/images/growth/personalization/download_app_qr_code_no_margin-vflidVVmZ.png");t.usePhoneNumberConstants=()=>{const[e,t]=a.useState(null);return a.useEffect(()=>{m.fetchPhoneNumberConstants().then(t)},[]),e};const R=({email:e,dontNotify:r=!1,loggingExtras:p={},sendEmailButtonRef:m,sendTextButtonRef:w,showPrimaryButton:R})=>{const T=I.QR,F=I.EMAIL,[L,x]=a.useState(T.id),[P,O]=a.useState(C);a.useEffect(()=>{R&&R(L!==I.QR.id),(function(){return s.__awaiter(this,void 0,void 0,(function*(){const e=k.getCurrentUser(),t=new M.DefaultUserApiV2Client(e),{image_src:s}=yield t.ns("growth").rpc("get_mobile_app_link_qr_image",void 0,{});return s}))})().then(e=>{O(e)})},[]);const j=t.usePhoneNumberConstants();return a.default.createElement("div",{className:"send-mobile-link"},a.default.createElement(c.Tabs,{selectedTab:L,onSelection:e=>{x(e),R&&R(e!==I.QR.id)}},a.default.createElement(c.Tabs.Group,null,a.default.createElement(c.Tabs.Tab,{id:T.id},T.label),a.default.createElement(c.Tabs.Tab,{id:F.id},F.label)),a.default.createElement(c.Tabs.Panel,{tabId:I.EMAIL.id},a.default.createElement("div",{className:"input-container"},a.default.createElement(u.Text,{tagName:"label",htmlFor:"email-input",size:"small",isBold:!0},I.EMAIL.content),a.default.createElement(d.TextInput,{id:"email-input",size:"large",value:e,withRightAccessory:a.default.createElement(n.UIIcon,{src:o.LockLine}),disabled:!0})),a.default.createElement(i.Button,{className:"setup-button",variant:"primary",size:"large",onClick:()=>s.__awaiter(void 0,void 0,void 0,(function*(){const t={ctaName:"email_link"};try{f.TeamsWebActionsLogger.log("send_mobile_app_link",Object.assign(Object.assign({},p),{cta_shown:"email_link",sent_address:e})),yield h.WebRequest({url:"/email_mobile_app",data:{recipient_email:e}}),t.success="true",r||E.Notify.success(S.intl.formatMessage(A,{email:e}))}catch(e){t.success="false",r||E.Notify.error(S.intl.formatMessage(N))}finally{g.SMBFunnelLogger.log(y.AMPMetrics.ACTIVATION_MOBILE_LINK_SEND,t)}})),ref:m,style:{display:m?"none":void 0}},I.EMAIL.buttonText),!!m&&a.default.createElement("div",{style:{height:2}}),a.default.createElement("div",{className:"notification-message"},a.default.createElement(u.Text,{tagName:"span",color:"faint"},S.intl.formatMessage({id:"hHhhyq",defaultMessage:"Double check your spam folder."})))),a.default.createElement(c.Tabs.Panel,{tabId:I.PHONE.id},a.default.createElement("div",{className:"input-container"},j?a.default.createElement(a.default.Fragment,null,a.default.createElement(u.Text,{tagName:"label",size:"small",isBold:!0},I.PHONE.content),a.default.createElement(_.SendAppLinkForm,{phoneInputData:j,onStatusChange:e=>{const{phoneNumber:t,sendStatus:s}=e;s===_.SendStatus.SENDING?f.TeamsWebActionsLogger.log("send_mobile_app_link",Object.assign(Object.assign({},p),{cta_shown:"text_link",sent_address:t})):s===_.SendStatus.SUCCESS?g.SMBFunnelLogger.log(y.AMPMetrics.ACTIVATION_MOBILE_LINK_SEND,{ctaName:"text_link",success:"true"}):s===_.SendStatus.FAILURE&&g.SMBFunnelLogger.log(y.AMPMetrics.ACTIVATION_MOBILE_LINK_SEND,{ctaName:"text_link",success:"false"}),r||_.showStatusUsingNotify(e)},size:"large",SubmitButton:()=>a.default.createElement(i.Button,{className:"setup-button",variant:"primary",size:"large",type:"submit",ref:w,style:{display:w?"none":void 0}},I.PHONE.buttonText),formTypes:[_.SendAppLinkFormType.SMS],buttonPosition:_.SendAppLinkButtonPosition.BOTTOM,isFullWidth:!0})):a.default.createElement("div",{style:{textAlign:"center"}},a.default.createElement(l.Spinner,{"aria-valuetext":"Loading"}))),!!j&&a.default.createElement(b.SendAppLinkFormDisclaimer,{size:"large",color:"faint"})),a.default.createElement(c.Tabs.Panel,{tabId:I.QR.id},a.default.createElement("div",{className:"input-container"},a.default.createElement("div",{className:"qr-code-container"},a.default.createElement("img",{className:"qr-code-img",alt:S.intl.formatMessage(v.messages.downloadAppQRCodeImageAlt),src:P}),a.default.createElement("div",{className:"qr-code-text-container"},a.default.createElement(u.Text,{tagName:"p",size:"standard"},I.QR.content)))))))};R.displayName="SendMobileLinkWithoutCss",t.SendMobileLink=w.requireCssWithComponent(R,["/static/css/admin/teams/essential_setup/send_mobile_link-vflGQi7zO.css"])})),define("metaserver/static/js/growth/ui/open_in_util",["require","exports","tslib","metaserver/static/js/modules/clean/active_user","metaserver/static/js/admin/ui/teams/onboarding/web/trackers/personalization_tracker","metaserver/static/js/growth/smb_funnel/smb_funnel_logger","metaserver/static/js/admin/ui/teams/onboarding/web/constants","metaserver/static/js/modules/clean/viewer","metaserver/static/js/modules/clean/analytics","metaserver/static/js/modules/core/browser","metaserver/static/js/modules/core/custom_protocol"],(function(e,t,s,a,r,i,n,o,l,c,d){"use strict";function u(e,t){t?c.redirect("/download"):c.redirect((null==e?void 0:e.is_team_admin)?"/team/setup/essential?autodownload=true":"/team/join/complete")}Object.defineProperty(t,"__esModule",{value:!0}),t.openInDesktopApp=t.redirectToDownloadPage=t.getCurrentUser=t.loggingExtras=t.ESSENTIAL_SETUP_SEEN_DESKTOP_TOOLTIP=t.ESSENTIAL_SETUP_ACTION_TRACKER=void 0,c=s.__importStar(c),t.ESSENTIAL_SETUP_ACTION_TRACKER="essential_setup",t.ESSENTIAL_SETUP_SEEN_DESKTOP_TOOLTIP="seen_desktop_tooltip",t.loggingExtras={module_name:"clink_first_task",framework:"team_setup_essential"},t.getCurrentUser=function(){const e=a.getActiveUser();if(e)return e;const t=o.Viewer.get_viewer().get_users();return t.length>0?t[t.length-1]:void 0},t.redirectToDownloadPage=u,t.openInDesktopApp=function({user:e,textType:a,openWithUnityArgs:o}){return s.__awaiter(this,void 0,void 0,(function*(){e&&(a&&r.trackClickDesktopCTA(),l.TeamsWebActionsLogger.log("desktop_icon_click",t.loggingExtras),d.canLaunchUri()||u(e,o),d.launchUri("dropbox-client://desktop_folder").then(()=>{var e;i.SMBFunnelLogger.log(n.AMPMetrics.ACTIVATION_DESKTOP_ICON_OPEN,{clientDetected:"true",surface:(null===(e=null==o?void 0:o.fileActionLoggerArgs)||void 0===e?void 0:e.actionSurface)||"none"}),l.TeamsWebActionsLogger.log("desktop_icon_click_result",Object.assign({result:"detected"},t.loggingExtras))}).catch(()=>{var s;i.SMBFunnelLogger.log(n.AMPMetrics.ACTIVATION_DESKTOP_ICON_OPEN,{clientDetected:"false",surface:(null===(s=null==o?void 0:o.fileActionLoggerArgs)||void 0===s?void 0:s.actionSurface)||"none"}),l.TeamsWebActionsLogger.log("desktop_icon_click_result",Object.assign({result:"no_client_detected"},t.loggingExtras)),u(e,o)}))}))}})),define("metaserver/static/js/growth/ui/open_in_mobile_modal_controller",["require","exports","tslib","react-redux","react","dig-components/buttons","dig-components/icons/src","dig-components/snackbar","dig-components/typography","dig-components/icons","metaserver/static/js/browse/data/selectors","metaserver/static/js/api_v2/default_user_client","metaserver/static/js/browse/data/store","metaserver/static/js/modules/core/i18n","metaserver/static/js/growth/ui/open_in_util","metaserver/static/js/growth/ui/send_mobile_link_modal","metaserver/static/js/modules/clean/viewer"],(function(e,t,s,a,r,i,n,o,l,c,d,u,p,m,h,f,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OpenInMobileModalController=t.OpenInMobileModalControllerWithoutProvider=void 0,r=s.__importDefault(r);let _=null;class b extends r.default.PureComponent{constructor(e){super(e),this.user=g.Viewer.get_viewer().work_user||g.Viewer.get_viewer().personal_user,this.handleDismissSendMobileLinkModal=()=>{this.setState({showSendMobileLinkModal:!1})},this.handleHideOpenInMobileSnackbar=()=>{this.setState({showOpenInMobileSnackbar:!1})},this.state={isSendingNotification:!1,showSendMobileLinkModal:!1,showOpenInMobileSnackbar:!1,dismissSendMobileLinkModalAfterSubmit:!1}}componentDidMount(){_||(_=this)}componentWillUnmount(){_=null}render(){const{showSendMobileLinkModal:e,showOpenInMobileSnackbar:t}=this.state,s=this.user&&r.default.createElement(f.SendMobileLinkModal,{linkedEmail:this.user.email,showSendMobileLinkModal:e,onDismiss:this.handleDismissSendMobileLinkModal,dismissAfterSubmit:this.state.dismissSendMobileLinkModalAfterSubmit,loggingExtras:h.loggingExtras}),a=r.default.createElement(o.Snackbar,{className:"open-in-mobile-snackbar",open:t,onRequestClose:this.handleHideOpenInMobileSnackbar,timeout:0},r.default.createElement(l.Text,{inverse:!0},r.default.createElement(c.UIIcon,{className:"open-in-mobile-snackbar__icon",src:n.CheckmarkCircleLine})),r.default.createElement(o.Snackbar.Message,null,m.intl.formatMessage({id:"U/fUL+",defaultMessage:"Check your device for a notification"})),r.default.createElement(o.Snackbar.Actions,null,r.default.createElement(i.Button,{variant:"transparent",inverse:!0,onClick:()=>{var e;return this.sendNotificationToPhone((null===(e=this.props.folder)||void 0===e?void 0:e.fq_path)||"/",this.state.campaign)}},m.intl.formatMessage({id:"A+nrfT",defaultMessage:"Send it again"})),r.default.createElement(i.Button,{variant:"transparent",inverse:!0,onClick:this.handleHideOpenInMobileSnackbar},m.intl.formatMessage({id:"JBINyn",defaultMessage:"Close"}))));return r.default.createElement(r.default.Fragment,null,s,a)}sendNotificationToPhone(e,t){return s.__awaiter(this,void 0,void 0,(function*(){this.setState({isSendingNotification:!0,campaign:t});try{const s=new u.DefaultUserApiV2Client(this.user),{success:a}=yield s.ns("growth").rpc("send_open_mobile_app_notification",{folder_path:e,campaign:t},{});if(!a)throw new Error("Not sent");this.setState({showOpenInMobileSnackbar:!0})}catch(e){this.setState({showSendMobileLinkModal:!0})}finally{this.setState({isSendingNotification:!1})}}))}showMobileLinkModal(e=!1){this.setState({showSendMobileLinkModal:!0,dismissSendMobileLinkModalAfterSubmit:e})}}t.OpenInMobileModalControllerWithoutProvider=b,b.displayName="OpenInMobileModalControllerWithoutProvider";const y=a.connect(e=>({expMobileAppLinksVariant:d.browsePostTTIExperiments(e).expMobileAppLinksVariant}))(b),v=p.getStoreForBrowse();class S extends r.default.PureComponent{static sendNotificationToPhone(e,t){return s.__awaiter(this,void 0,void 0,(function*(){_&&!_.state.isSendingNotification&&(yield _.sendNotificationToPhone(e,t))}))}static showMobileLinkModal(e=!1){_&&!_.state.showSendMobileLinkModal&&_.showMobileLinkModal(e)}render(){return r.default.createElement(a.Provider,{store:v},r.default.createElement(y,Object.assign({},this.props)))}}t.OpenInMobileModalController=S,S.displayName="OpenInMobileModalController"})),define("metaserver/static/js/growth/ui/personalization/download_app_zone/messages",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.messages=void 0,t.messages={downloadAppQRCodeTitle:{id:"downloadAppQRCodeTitle",defaultMessage:"Install Dropbox on your devices",description:"Download App panel title"},downloadAppQRCodeDescription:{id:"downloadAppQRCodeDescription",defaultMessage:"Open your phone camera and point it here or <Button>get a link</Button>",description:"Description text on how to use the QR code"},downloadAppQRCodeImageAlt:{id:"downloadAppQRCodeImageAlt",defaultMessage:"Download Dropbox using this QR code",description:"Alt text for QR code image"},sendDownloadAppLinkSuccess:{id:"sendDownloadAppLinkSuccess",defaultMessage:"Link sent to {email}",description:"Success message for sending download app link"},sendDownloadAppLinkError:{id:"sendDownloadAppLinkError",defaultMessage:"Error sending the link, please try again.",description:"Error message for failing to send the download app link"},dismissDownloadAppZone:{id:"dismissDownloadAppZone",defaultMessage:"Dismiss panel",description:"Dismiss panel action aria-label text"}}})),define("metaserver/static/js/growth/ui/send_app_link_form",["require","exports","tslib","react","react-dom","metaserver/static/js/components/ui/css","phone_helpers","metaserver/static/js/modules/constants/viewer","classnames","metaserver/static/js/modules/core/notify","metaserver/static/js/modules/core/i18n","metaserver/static/js/deprecated_ajax/ajax_jquery","metaserver/static/js/modules/clean/mobile_tracker","metaserver/static/js/growth/ui/send_app_link_form_disclaimer","metaserver/static/js/modules/clean/validators/email_validator","metaserver/static/js/modules/core/dom","dig-components/form_row","dig-components/text_fields","dig-components/icons","dig-components/icons/src","dig-components/typography","dig-components/buttons"],(function(e,t,s,a,r,i,n,o,l,c,d,u,p,m,h,f,g,_,b,y,v,S){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SendAppLinkForm=t.SendAppLinkFormComponent=t.showStatusUsingNotify=t.SendAppLinkFormLayout=t.SendAppLinkButtonPosition=t.SendAppLinkFormType=t.SendStatus=void 0,a=s.__importDefault(a),r=s.__importStar(r),n=s.__importStar(n),o=s.__importStar(o),l=s.__importDefault(l),u=s.__importStar(u),h=s.__importDefault(h),f=s.__importStar(f);const E=["AQ","BV","PN"];var w,M,k;(function(e){e.SENDING="sending",e.SUCCESS="success",e.INVALID="invalid",e.FAILURE="failure"})(w=t.SendStatus||(t.SendStatus={})),(function(e){e.SMS="sms",e.EMAIL="email"})(M=t.SendAppLinkFormType||(t.SendAppLinkFormType={})),(function(e){e.RIGHT="button-right",e.BOTTOM="button-bottom"})(t.SendAppLinkButtonPosition||(t.SendAppLinkButtonPosition={})),(function(e){e.DEFAULT="default",e.SUBMIT_ON_BOTTOM="submit-on-bottom"})(k=t.SendAppLinkFormLayout||(t.SendAppLinkFormLayout={}));t.showStatusUsingNotify=({currentFormType:e,sendStatus:t,phoneNumber:s,email:a})=>{switch(c.Notify.clear(),t){case w.SENDING:c.Notify.info(d.intl.formatMessage({id:"zq/eht",defaultMessage:"Sending"}),60);break;case w.SUCCESS:let t;switch(e){case M.SMS:t=d.intl.formatMessage({id:"GHBzHK",defaultMessage:"Link sent to {phone_number}"},{phone_number:s});break;case M.EMAIL:t=d.intl.formatMessage({id:"RQAh9Y",defaultMessage:"Link sent to {email}"},{email:a})}t&&c.Notify.success(t,3);break;case w.INVALID:let r;switch(e){case M.SMS:r=d.intl.formatMessage({id:"SYbWri",defaultMessage:"Please enter a valid phone number"});break;case M.EMAIL:r=d.intl.formatMessage({id:"CAJjXO",defaultMessage:"Please enter a valid email address"})}r&&c.Notify.error(r,3);break;case w.FAILURE:c.Notify.error(d.intl.formatMessage({id:"2/fjiQ",defaultMessage:"There was an error sending the link"}),3)}};class A extends a.default.Component{constructor(e){if(super(e),this.getUnformattedNumber=e=>(e=e||this.state.phoneNumber).replace(/[^\d]/g,""),this.isPhoneNumberValid=e=>{e=e||this.state.phoneNumber;const t=this.getPhoneNumberPlaceholder();return this.getUnformattedNumber(e).length===this.getUnformattedNumber(t).length},this.isEmailValid=e=>(e=e||this.state.email,h.default.validate(e).every(e=>e.valid)),this.handleSubmit=e=>{e.preventDefault();const t=p.getMobileTrackerCampaignParams();switch(this.state.currentFormType){case M.SMS:this.state.sendStatus!==w.SENDING&&(this.isPhoneNumberValid()?(this.setState({sendStatus:w.SENDING}),u.SilentBackgroundRequest({url:"/text_mobile_app",data:Object.assign({country_code:this.getCountryCode(),phone_number:this.getUnformattedNumber()},t),success:e=>{"True"===e?this.setState({sendStatus:w.SUCCESS}):this.setState({sendStatus:w.FAILURE})},error:()=>{this.setState({sendStatus:w.FAILURE})}})):this.setState({sendStatus:w.INVALID}));break;case M.EMAIL:this.state.sendStatus!==w.SENDING&&(this.isEmailValid()?(this.setState({sendStatus:w.SENDING}),u.SilentBackgroundRequest({url:"/email_mobile_app",data:Object.assign({recipient_email:this.state.email},t),success:e=>{"True"===e?this.setState({sendStatus:w.SUCCESS}):this.setState({sendStatus:w.FAILURE})},error:()=>{this.setState({sendStatus:w.FAILURE})}})):this.setState({sendStatus:w.INVALID}))}this.props.onSubmit&&this.props.onSubmit(e)},this.handlePhoneNumberInput=()=>{this.phoneNumberInput&&this.setState({phoneNumber:this.phoneNumberInput.value})},this.handleCountryCodeInput=e=>{this.setState({countryAbbreviation:e.target.value})},this.getStateIconElement=()=>{const e="send-app-link-form__phone-email-input-icon";switch(this.state.sendStatus){case w.SUCCESS:return a.default.createElement(v.Text,{className:e},a.default.createElement(b.UIIcon,{src:y.CheckmarkLine}));case w.INVALID:return a.default.createElement(v.Text,{className:e,color:"error"},a.default.createElement(b.UIIcon,{src:y.WarningLine}))}return null},this.getCountryIso=()=>n.iso_to_dialing(this.state.countryAbbreviation),this.getPhoneNumberPlaceholder=()=>n.get_example_mobile_number(this.getCountryIso()),this.getCountryCode=e=>(e=e||this.state.countryAbbreviation,this.props.phoneInputData?this.props.phoneInputData.phone_code_map[e]:null),this.setPhoneNumberInputRef=e=>this.phoneNumberInput=e,this.handleFocusCountryCode=()=>{this.setState({isCountryCodeFocused:!0})},this.handleBlurCountryCode=()=>{this.setState({isCountryCodeFocused:!1})},this.renderHelperText=()=>{const{inputHelperText:e}=this.props,{sendStatus:t}=this.state;return e?a.default.createElement(g.FormHelperText,{isInvalid:t===w.INVALID||t===w.FAILURE},e):null},this.getPhoneInput=()=>{const{phoneInputData:e,buttonPosition:t,isFullWidth:s,smsInputPlaceholder:r,size:i="standard"}=this.props,{countryAbbreviation:o,sendStatus:c,phoneNumber:u,isCountryCodeFocused:p,mouseInSelect:m}=this.state,h=n.format(this.getCountryIso(),u),f=this.getPhoneNumberPlaceholder();return e?a.default.createElement("div",{className:`\n        send-app-link-form__phone-input\n        send-app-link-form__phone-input--${t}\n        send-app-link-form__phone-input--${s?"full-width":"auto-width"}\n        send-app-link-form__phone-input--${c}\n      `},a.default.createElement("div",{className:"send-app-link-form__phone-input__input-group"},a.default.createElement("div",{className:"send-app-link-form__country-select"},a.default.createElement("label",{htmlFor:"send-app-link-form__country-select__input"},d.intl.formatMessage({id:"1SPrvR",defaultMessage:"Country"})),a.default.createElement("select",{id:"send-app-link-form__country-select__input",name:"country",className:"send-app-link-form__country-select__input",onChange:this.handleCountryCodeInput,onFocus:this.handleFocusCountryCode,onBlur:this.handleBlurCountryCode,value:o,onMouseEnter:this.onMouseEnterSelect,onMouseLeave:this.onMouseLeaveSelect},a.default.createElement("option",{disabled:!0,"aria-selected":!1},d.intl.formatMessage({id:"LrbExT",defaultMessage:"Country code"})),e.country_list.map(e=>{const[t,s]=e,r=this.getCountryCode(t);return r&&-1===E.indexOf(t)?a.default.createElement("option",{value:t,key:t,"aria-selected":o===t},`${s} ${r}`):null})),a.default.createElement("div",{className:l.default({"send-app-link-form__country-select__display":!0,"send-app-link-form__country-select__display--invalid":c===w.INVALID||c===w.FAILURE,"send-app-link-form__country-select__display--focused":p,"send-app-link-form__country-select__display--hovered":m}),"aria-hidden":!0},this.getCountryCode(),a.default.createElement(v.Text,{className:"send-app-link-form__country-select__display__icon"},a.default.createElement(b.UIIcon,{src:y.ChevronDownLine})))),a.default.createElement("div",{className:"send-app-link-form__phone-number"},a.default.createElement("label",{htmlFor:"send-app-link-form__phone-number__input"},d.intl.formatMessage({id:"iWHTv1",defaultMessage:"Phone number"})),a.default.createElement(_.TextInput,{id:"send-app-link-form__phone-number__input",type:"tel",name:"phone_number",className:"\n                send-app-link-form__phone-number__input\n              ",isInvalid:c===w.INVALID||c===w.FAILURE,placeholder:r||d.intl.formatMessage({id:"iWHTv1",defaultMessage:"Phone number"}),value:h,onChange:this.handlePhoneNumberInput,ref:this.setPhoneNumberInputRef,maxLength:f.length,size:i}),this.getStateIconElement())),this.renderHelperText()):null},this.setEmailInputRef=e=>this.emailInput=e,this.handleEmailInput=()=>{this.emailInput&&this.setState({email:this.emailInput.value})},this.getEmailInput=()=>{const{sendStatus:e,email:t}=this.state,{buttonPosition:s,isFullWidth:r,emailInputPlaceholder:i,size:n="standard"}=this.props;return a.default.createElement("div",{className:`\n        send-app-link-form__email-input\n        send-app-link-form__email-input--${s}\n        send-app-link-form__email-input--${r?"full-width":"auto-width"}\n        send-app-link-form__email-input--${e}\n      `},a.default.createElement("div",{className:"send-app-link-form__email-input__input-group"},a.default.createElement("label",{htmlFor:"send-app-link-form__email__input"},d.intl.formatMessage({id:"yU0xda",defaultMessage:"Email address"})),a.default.createElement(_.TextInput,{id:"send-app-link-form__email__input",type:"email",name:"email",placeholder:i||d.intl.formatMessage({id:"yU0xda",defaultMessage:"Email address"}),value:t,onChange:this.handleEmailInput,ref:this.setEmailInputRef,isInvalid:e===w.INVALID||e===w.FAILURE,size:n}),this.getStateIconElement()),this.renderHelperText())},this.onMouseEnterSelect=()=>{this.setState({mouseInSelect:!0})},this.onMouseLeaveSelect=()=>{this.setState({mouseInSelect:!1})},this.getInactiveFormType=()=>{const e=this.props.formTypes.filter(e=>e!==this.state.currentFormType);return e.length?e[0]:null},this.getFormInputElement=()=>{switch(this.state.currentFormType){case M.SMS:return this.getPhoneInput();case M.EMAIL:return this.getEmailInput();default:return null}},this.getFormSwitchPhrase=()=>{switch(this.getInactiveFormType()){case M.SMS:return d.intl.formatMessage({id:"NIcDB+",defaultMessage:"Or text me the link"});case M.EMAIL:return d.intl.formatMessage({id:"2WiFdV",defaultMessage:"Or email me the link"});default:return null}},this.handleClickFormSwitch=e=>{e.preventDefault();const t=this.getInactiveFormType();t&&this.setState({currentFormType:t})},this.setFormRef=e=>{this.formRef=e},this.getSubmitButton=()=>{const{SubmitButton:e,isFullWidth:t}=this.props,{sendStatus:s,currentFormType:r}=this.state;return a.default.createElement("div",{className:`\n          send-app-link-form__submit-wrapper\n          send-app-link-form__submit-wrapper--${t?"full-width":"auto-width"}\n        `},a.default.createElement(e,{sendStatus:s,currentFormType:r}))},this.getFormSwitchButton=e=>{const{isFullWidth:t,size:s}=this.props;return a.default.createElement("div",{className:l.default({"send-app-link-form__form-switch__wrapper":!0,"send-app-link-form__form-switch__wrapper--full-width":t,"send-app-link-form__form-switch__wrapper--auto-width":!t})},a.default.createElement(S.Button,{size:"large"===s?"standard":"small",variant:"transparent",onClick:this.handleClickFormSwitch,type:"button"},e))},this.getDisclaimer=()=>{const{currentFormType:e}=this.state,{size:t,disclaimerColor:s}=this.props;return a.default.createElement("div",{className:`\n              send-app-link-form__disclaimer\n              send-app-link-form__disclaimer--${e===M.SMS?"visible":"hidden"}\n            `,"aria-hidden":e!==M.SMS},a.default.createElement(m.SendAppLinkFormDisclaimer,{tabIndex:e===M.SMS?0:-1,onShowTooltip:this.props.onShowDisclaimerTooltip,size:t,color:s}))},e.formTypes.includes(M.SMS)&&!e.phoneInputData)throw new Error("SMS form type required phoneInputData prop");this.state={currentFormType:e.formTypes[0],phoneNumber:"",countryAbbreviation:o.LOCALE||"US",isCountryCodeFocused:!1,email:e.defaultUserEmail?e.defaultUserEmail:"",sendStatus:null,mouseInSelect:!1}}componentDidUpdate(e,t){const{onStatusChange:s,onSwitchFormType:a,onChangeCountryCode:i}=this.props,{sendStatus:n,phoneNumber:l,countryAbbreviation:c,currentFormType:d,email:u}=this.state;if(s&&t.sendStatus!==n&&s({currentFormType:d,sendStatus:n,phoneNumber:l,email:u}),t.phoneNumber===l&&t.countryAbbreviation===c&&t.email===u&&t.currentFormType===d||(this.setState({sendStatus:null}),i&&c!==t.countryAbbreviation&&i(c),this.props.onChangeInput&&(t.email!==u?this.props.onChangeInput(u):t.phoneNumber!==l&&this.props.onChangeInput(l))),t.currentFormType!==d){if(this.setState({phoneNumber:"",countryAbbreviation:o.LOCALE||"US",email:this.props.defaultUserEmail?this.props.defaultUserEmail:""}),this.formRef){const e=r.findDOMNode(this.formRef),t=f.getTabbableElementsIn(e);t.length&&t[0].focus()}a&&a(d)}}render(){const{formTypes:e,buttonPosition:t,showDisclaimer:s,formLayout:r}=this.props,i=this.getFormSwitchPhrase(),n=this.getFormInputElement(),o=this.getSubmitButton(),l=e.length>1&&i&&this.getFormSwitchButton(i),c=s&&this.getDisclaimer();let d=a.default.createElement(a.default.Fragment,null,n,o,l,c);switch(r){case k.SUBMIT_ON_BOTTOM:d=a.default.createElement(a.default.Fragment,null,n,c,l,o)}return a.default.createElement("form",{noValidate:!0,onSubmit:this.handleSubmit,className:`\n          send-app-link-form\n          send-app-link-form--${t}\n        `,ref:this.setFormRef},d)}}t.SendAppLinkFormComponent=A,A.displayName="SendAppLinkFormComponent",t.SendAppLinkForm=i.requireCssWithComponent(A,["/static/css/dig-components/index.web-vflkNfl3z.css","/static/css/growth/send_app_link_form-vflK1r87S.css"])})),define("metaserver/static/js/growth/ui/send_app_link_form_disclaimer",["require","exports","tslib","react","metaserver/static/js/components/ui/css","metaserver/static/js/modules/core/i18n","dig-components/tooltips","dig-components/typography"],(function(e,t,s,a,r,i,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SendAppLinkFormDisclaimer=t.SendAppLinkFormDisclaimerComponent=void 0,a=s.__importStar(a);const l=e=>{const{onShowTooltip:t}=e;return a.useEffect(()=>{t&&t()},[t]),a.default.createElement("span",null,i.intl.formatMessage({id:"tZ+OmK",defaultMessage:"I agree that Dropbox may send me messages using an automatic telephone dialing system at the provided phone number. I understand that I am not required to agree in order to sign up for Dropbox. I understand that standard data and message rates may apply."}))};l.displayName="MyCustomTooltipContent";t.SendAppLinkFormDisclaimerComponent=e=>{const{tabIndex:t=0,size:s,color:r,onShowTooltip:c}=e,d="send-app-link-form-disclaimer__tooltip",u="large"===s?"standard":"xsmall";return a.default.createElement("span",null,a.default.createElement(o.Text,{className:"send-app-link-form-disclaimer",size:u,color:r},i.intl.formatMessage({id:"99UyMq",defaultMessage:"Standard rates apply."})," "),a.default.createElement(n.Tooltip,{placement:"top",title:a.default.createElement(l,{onShowTooltip:c}),id:d},a.default.createElement(o.Text,{size:u,color:r,isBold:!0,tabIndex:t,className:"send-app-link-form-disclaimer__trigger","aria-describedby":d},i.intl.formatMessage({id:"0GIkLa",defaultMessage:"See more"}))))},t.SendAppLinkFormDisclaimerComponent.displayName="SendAppLinkFormDisclaimerComponent",t.SendAppLinkFormDisclaimer=r.requireCssWithComponent(t.SendAppLinkFormDisclaimerComponent,["/static/css/growth/send_app_link_form_disclaimer-vflzqd4HK.css"])})),define("metaserver/static/js/growth/ui/send_mobile_link_modal",["require","exports","tslib","react","dig-components/modal","dig-components/buttons","dig-components/typography","metaserver/static/js/modules/core/i18n","metaserver/static/js/admin/ui/teams/onboarding/web/components/send_mobile_link"],(function(e,t,s,a,r,i,n,o,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SendMobileLinkModal=void 0,a=s.__importDefault(a);class c extends a.default.PureComponent{constructor(e){super(e),this.submitButtonRef=a.default.createRef(),this.showPrimaryButton=e=>{this.setState({showPrimaryButton:e})},this.closeModal=()=>{this.props.onDismiss()},this.submit=()=>{this.submitButtonRef.current&&this.submitButtonRef.current.click(),this.props.dismissAfterSubmit&&this.closeModal()},this.state={showPrimaryButton:!0}}render(){const{linkedEmail:e,loggingExtras:t,showSendMobileLinkModal:s}=this.props;return a.default.createElement(r.Modal,{className:"send-mobile-link-modal",open:s,width:"small",onRequestClose:this.closeModal},a.default.createElement(r.Modal.Header,{hasBottomSpacing:"title-standard"},a.default.createElement(n.Title,null,o.intl.formatMessage({id:"HzJQla",defaultMessage:"How should we send the download link to your mobile device?"}))),a.default.createElement(r.Modal.Body,null,a.default.createElement(l.SendMobileLink,{email:e,sendTextButtonRef:this.submitButtonRef,sendEmailButtonRef:this.submitButtonRef,loggingExtras:t,showPrimaryButton:this.showPrimaryButton})),a.default.createElement(r.Modal.Footer,null,a.default.createElement(i.Button,{variant:"opacity",onClick:this.closeModal},o.intl.formatMessage({id:"NQmRjS",defaultMessage:"Cancel"})),this.state.showPrimaryButton&&a.default.createElement(i.Button,{variant:"primary",onClick:this.submit},o.intl.formatMessage({id:"wHAaDF",defaultMessage:"Send me a link"}))))}}t.SendMobileLinkModal=c,c.displayName="SendMobileLinkModal"}));
//# sourceMappingURL=pkg-browse-file-actions.min.js-vfl06rupo.map