!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.FrameMessenger=t():e.FrameMessenger=t()}(window,function(){return function(e){var t={};function s(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,s),n.l=!0,n.exports}return s.m=e,s.c=t,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(r,n,function(t){return e[t]}.bind(null,n));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=0)}([function(e,t,s){"use strict";s.r(t);class r{constructor(e,t=(e=>JSON.parse(e.data)),s=(e=>JSON.stringify(e))){this._window=window,this.handleUntrustedMessage=(e=>{if(!this.isOriginAllowed(e.origin))return;let t;try{t=this.receiveMessageConverter(e)}catch(e){return}null!=t.action&&this.handleTrustedMessage(e,t)}),this.allowedOrigins=e,this.receiveMessageConverter=t,this.sendMessageConverter=s}getWindow(){return this._window}setWindow(e){this._window=e}startListening(){this.getWindow().addEventListener("message",this.handleUntrustedMessage)}stopListening(){this.getWindow().removeEventListener("message",this.handleUntrustedMessage)}regexIn(e,t){for(const s of t){if(s instanceof RegExp&&e.match(s))return!0;if("string"==typeof s&&s===e)return!0}return!1}static stripStandardPort(e){return"http://"===e.substr(0,7)?e.replace(/:80$/,""):"https://"===e.substr(0,8)?e.replace(/:443$/,""):e}isOriginAllowed(e){return this.regexIn(r.stripStandardPort(e),this.allowedOrigins)}packagePostMessage(e,t){const s={action:e,parameters:t};return this.sendMessageConverter(s)}}class n extends r{constructor(){super(...arguments),this.trustedOriginForPosting=null,this.validActions=[],this.trustedMessageHandler=null,this.parentMessageQueue=[],this.onParentReady=null}configureParentMessaging(e,t,s=null){this.resetOriginsForPosting(),this.validActions=t,this.trustedMessageHandler=e,this.onParentReady=s}startListening(){super.startListening(),this.requestParentOrigin()}postMessageToParent(e,t={}){const s=this.packagePostMessage(e,t);null===this.trustedOriginForPosting?this.parentMessageQueue.push(s):this.getWindow().parent.postMessage(s,this.trustedOriginForPosting)}handleTrustedMessage(e,t){"parent-ready"===t.action&&this.updateParentOrigin(e.origin),-1!==this.validActions.indexOf(t.action)&&null!==this.trustedMessageHandler&&this.trustedMessageHandler(t)}resetOriginsForPosting(){this.trustedOriginForPosting=null}updateParentOrigin(e){const t=this.trustedOriginForPosting;return!!this.isOriginAllowed(e)&&(this.trustedOriginForPosting=e,this.parentMessageQueue.length>0&&(this.parentMessageQueue.forEach(e=>{const t=JSON.parse(e);this.postMessageToParent(t.action,t.parameters)}),this.parentMessageQueue=[]),null!=this.trustedOriginForPosting&&null==t&&null!=this.onParentReady&&this.onParentReady(),!0)}requestParentOrigin(){this.getWindow().parent.postMessage('{"action": "child-requesting-parent-origin"}',"*");this.getWindow().setTimeout(()=>{null==this.trustedOriginForPosting&&this.requestParentOrigin()},n._REQUEST_PARENT_ORIGIN_POLL_DELAY)}}n._REQUEST_PARENT_ORIGIN_POLL_DELAY=100,s.d(t,"PreviewFrameMessengerClient",function(){return i});class i extends n{constructor(){super(["https://www.dropbox.com","https://www.dropbox.com:443",/^https:\/\/meta-[a-zA-Z0-9\-]+\.dev\.corp\.dropbox\.com(:443)?$/,/^dbx-local:\/\/*/])}}}])});